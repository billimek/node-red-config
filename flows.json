[{"id":"afb0f186.cfb0d","type":"tab","label":"Home Assistant","disabled":false,"info":""},{"id":"ea946133.0085b","type":"tab","label":"Cameras","disabled":false,"info":""},{"id":"4aedf9e8.044e08","type":"tab","label":"Alarm","disabled":false,"info":""},{"id":"9143c7f2.16df18","type":"tab","label":"Presence","disabled":false,"info":""},{"id":"75b62c93.dd5d84","type":"tab","label":"Garage","disabled":false,"info":""},{"id":"af228686.65c8a8","type":"tab","label":"zwave","disabled":false,"info":""},{"id":"2fad043e.317c8c","type":"tab","label":"Pending Deprecation","disabled":true,"info":""},{"id":"b8b74cae.ffe4","type":"subflow","name":"open?","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"4b2cdbdc.3114a4"}]}],"out":[{"x":520,"y":20,"wires":[{"id":"99015cad.bf158","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"a9b8c57d.9659a8","type":"subflow","name":"closed?","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"39ce4ca0.57f4a4"}]}],"out":[{"x":520,"y":40,"wires":[{"id":"d1347059.c62f3","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"8b52884a.b76658","type":"server","z":"","name":"Home Assistant","legacy":false,"hassio":false,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open"},{"id":"649859a4.a17818","type":"mqtt-broker","z":"","name":"rabbitmq","broker":"10.2.0.102","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"1be7789.845ca87","type":"pushover-keys","z":"","name":""},{"id":"f26da246.74a7f","type":"light-scheduler-settings","z":"","name":"home","latitude":"33.95092","longitude":"-84.44805"},{"id":"738ad7f2.c345c8","type":"api-call-service","z":"afb0f186.cfb0d","name":"Turn on Basement Fan","server":"8b52884a.b76658","service_domain":"climate","service":"set_fan_mode","data":"{\"entity_id\":\"climate.basement\",\"fan_mode\":\"on\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":560,"y":80,"wires":[[]]},{"id":"dcb17b9f.340438","type":"bigtimer","z":"afb0f186.cfb0d","outtopic":"","outpayload1":"1","outpayload2":"","name":"Noon every day","comment":"","lat":"33.94519","lon":"-84.45379","starttime":"720","endtime":"735","starttime2":0,"endtime2":0,"startoff":"0","endoff":"0","offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":160,"y":80,"wires":[["ca516132.aac1d"],[],[]]},{"id":"6cb23d50.77ced4","type":"bigtimer","z":"4aedf9e8.044e08","outtopic":"","outpayload1":"1","outpayload2":"","name":"Midnight every day","comment":"","lat":"33.94519","lon":"-84.45379","starttime":"0","endtime":"15","starttime2":0,"endtime2":0,"startoff":"0","endoff":"0","offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":130,"y":100,"wires":[["cd1caa8c.300358"],[],[]]},{"id":"c77d382a.cb6bf8","type":"api-current-state","z":"4aedf9e8.044e08","name":"home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":530,"y":100,"wires":[["8d782ee4.3daf1"],[]]},{"id":"bafec0ae.30733","type":"inject","z":"4aedf9e8.044e08","name":"force-run","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":160,"wires":[["cd1caa8c.300358"]]},{"id":"24e58e6b.442df2","type":"bigtimer","z":"4aedf9e8.044e08","outtopic":"","outpayload1":"1","outpayload2":"","name":"5am every day","comment":"","lat":"33.94519","lon":"-84.45379","starttime":"300","endtime":"315","starttime2":0,"endtime2":0,"startoff":"0","endoff":"0","offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":140,"y":280,"wires":[["b15d162c.105c28"],[],[]]},{"id":"73c30e71.e8d46","type":"api-current-state","z":"4aedf9e8.044e08","name":"home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":530,"y":280,"wires":[["f36487b8.7e8c48"],[]]},{"id":"d6646d02.af28b","type":"inject","z":"4aedf9e8.044e08","name":"force-run","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":340,"wires":[["b15d162c.105c28"]]},{"id":"8d782ee4.3daf1","type":"api-current-state","z":"4aedf9e8.044e08","name":"alarm disarmed?","server":"8b52884a.b76658","halt_if":"disarmed","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"alarm_control_panel.alarm_panel","state_type":"str","outputs":2,"x":750,"y":100,"wires":[["892a8bfd.69c738"],[]]},{"id":"f36487b8.7e8c48","type":"api-current-state","z":"4aedf9e8.044e08","name":"alarm not disarmed?","server":"8b52884a.b76658","halt_if":"disarmed","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"alarm_control_panel.alarm_panel","state_type":"str","outputs":2,"x":760,"y":280,"wires":[["81c2d258.033ce"],[]]},{"id":"2f902d29.65f162","type":"mqtt in","z":"ea946133.0085b","name":"Front Camera (frigate)","topic":"frigate/front/objects","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":140,"y":60,"wires":[["f981233a.919ee"]]},{"id":"dac685a2.2c81f8","type":"mqtt in","z":"ea946133.0085b","name":"Porch Camera (frigate)","topic":"frigate/porch/objects","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":140,"y":220,"wires":[["d9d5eb14.a24088"]]},{"id":"12525f60.1cb281","type":"mqtt in","z":"ea946133.0085b","name":"Driveway Camera (frigate)","topic":"frigate/driveway/objects","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":150,"y":460,"wires":[["4a3232d5.83a38c"]]},{"id":"6b8b5f2f.4ae78","type":"mqtt in","z":"ea946133.0085b","name":"Pool Camera (frigate)","topic":"frigate/pool/objects","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":140,"y":760,"wires":[["7f697fd9.9e767"]]},{"id":"5d436f22.73ef","type":"mqtt in","z":"ea946133.0085b","name":"Basement Camera (frigate)","topic":"frigate/basement/objects","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":150,"y":920,"wires":[["6c4e92b2.bf3b7c"]]},{"id":"f981233a.919ee","type":"switch","z":"ea946133.0085b","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"{\"person\": \"ON\"}","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":60,"wires":[["118c8baa.e4f2b4"]]},{"id":"d9d5eb14.a24088","type":"switch","z":"ea946133.0085b","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"{\"person\": \"ON\"}","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":220,"wires":[["f66a0af1.123158"]]},{"id":"4a3232d5.83a38c","type":"switch","z":"ea946133.0085b","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"{\"person\": \"ON\"}","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":460,"wires":[["2f55ba6.ba56a46"]]},{"id":"7f697fd9.9e767","type":"switch","z":"ea946133.0085b","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"{\"person\": \"ON\"}","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":760,"wires":[["becdac9d.28d67"]]},{"id":"6c4e92b2.bf3b7c","type":"switch","z":"ea946133.0085b","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"{\"person\": \"ON\"}","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":920,"wires":[["7365e499.488e4c"]]},{"id":"cdcecccd.15beb","type":"function","z":"ea946133.0085b","name":"trigger basement camera (BI)","func":"msg.payload = \"camera=basement&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":940,"y":980,"wires":[["3f56c50a.db089a"]]},{"id":"3f56c50a.db089a","type":"mqtt out","z":"ea946133.0085b","name":"trigger blue iris","topic":"BlueIris/admin","qos":"","retain":"","broker":"649859a4.a17818","x":1200,"y":540,"wires":[]},{"id":"fecab8f7.aa5b18","type":"function","z":"ea946133.0085b","name":"trigger porch camera (BI)","func":"msg.payload = \"camera=porch&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":930,"y":260,"wires":[["3f56c50a.db089a"]]},{"id":"feaab13e.d12ba","type":"function","z":"ea946133.0085b","name":"trigger front camera (BI)","func":"msg.payload = \"camera=front&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":930,"y":120,"wires":[["3f56c50a.db089a"]]},{"id":"69e6676b.787a18","type":"function","z":"ea946133.0085b","name":"trigger driveway camera (BI)","func":"msg.payload = \"camera=driveway&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":940,"y":520,"wires":[["3f56c50a.db089a"]]},{"id":"d3be975d.234b68","type":"function","z":"ea946133.0085b","name":"trigger pool camera (BI)","func":"msg.payload = \"camera=pool&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":930,"y":800,"wires":[["3f56c50a.db089a"]]},{"id":"118c8baa.e4f2b4","type":"api-current-state","z":"ea946133.0085b","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.camera_front_notify","state_type":"str","outputs":2,"x":510,"y":60,"wires":[["feaab13e.d12ba","aa7a14fb.bcc2a8"],[]]},{"id":"f66a0af1.123158","type":"api-current-state","z":"ea946133.0085b","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.camera_porch_notify","state_type":"str","outputs":2,"x":510,"y":220,"wires":[["52638bf.b8eb974"],[]]},{"id":"2f55ba6.ba56a46","type":"api-current-state","z":"ea946133.0085b","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.camera_driveway_notify","state_type":"str","outputs":2,"x":510,"y":460,"wires":[["1bf8db6a.31e655"],[]]},{"id":"becdac9d.28d67","type":"api-current-state","z":"ea946133.0085b","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.camera_pool_notify","state_type":"str","outputs":2,"x":510,"y":760,"wires":[["28c9cb8c.3c71c4"],[]]},{"id":"7365e499.488e4c","type":"api-current-state","z":"ea946133.0085b","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.camera_basement_notify","state_type":"str","outputs":2,"x":510,"y":920,"wires":[["cdcecccd.15beb","8cfc67b3.80d9d8"],[]]},{"id":"ca516132.aac1d","type":"api-current-state","z":"afb0f186.cfb0d","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_run_basement_fan","state_type":"str","outputs":2,"x":350,"y":80,"wires":[["738ad7f2.c345c8"],[]]},{"id":"cd1caa8c.300358","type":"api-current-state","z":"4aedf9e8.044e08","name":"run?","server":"8b52884a.b76658","halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_arm_disarm_alarm_night","state_type":"str","outputs":2,"x":350,"y":100,"wires":[["c77d382a.cb6bf8"],[]]},{"id":"b15d162c.105c28","type":"api-current-state","z":"4aedf9e8.044e08","name":"run?","server":"8b52884a.b76658","halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_arm_disarm_alarm_night","state_type":"str","outputs":2,"x":350,"y":280,"wires":[["73c30e71.e8d46"],[]]},{"id":"52638bf.b8eb974","type":"api-current-state","z":"ea946133.0085b","name":"not home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":690,"y":220,"wires":[["246aae0.b493f52","fecab8f7.aa5b18"],["be993a9b.fa2da8"]]},{"id":"28c9cb8c.3c71c4","type":"api-current-state","z":"ea946133.0085b","name":"not home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":690,"y":760,"wires":[["6c431925.fa56b8","d3be975d.234b68"],["1457ac16.ec37e4"]]},{"id":"8cfc67b3.80d9d8","type":"api-call-service","z":"ea946133.0085b","name":"tf basement camera","server":"8b52884a.b76658","service_domain":"image_processing","service":"scan","data":"{\"entity_id\":\"image_processing.tensorflow_basement\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":920,"y":920,"wires":[["2c3dac8f.e1d3d4"]]},{"id":"2c3dac8f.e1d3d4","type":"api-current-state","z":"ea946133.0085b","name":"tf basement camera?","server":"8b52884a.b76658","halt_if":"0","halt_if_type":"num","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"image_processing.tensorflow_basement","state_type":"num","outputs":2,"x":1200,"y":920,"wires":[["c99d18d2.ef69e8"],[]]},{"id":"c99d18d2.ef69e8","type":"api-call-service","z":"ea946133.0085b","name":"Notify Slack","server":"8b52884a.b76658","service_domain":"notify","service":"slack","data":"{\"message\":\"Basement Camera Motion Alert\",\"title\":\"basement_latest.jpg\",\"data\":{\"file\":{\"path\":\"/config/www/tensorflow/snapshot/basement_latest.jpg\"}}}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1410,"y":920,"wires":[[]]},{"id":"6c431925.fa56b8","type":"api-call-service","z":"ea946133.0085b","name":"tf pool camera","server":"8b52884a.b76658","service_domain":"image_processing","service":"scan","data":"{\"entity_id\":\"image_processing.tensorflow_pool\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":900,"y":740,"wires":[["c2ba26e0.3af468"]]},{"id":"c2ba26e0.3af468","type":"api-current-state","z":"ea946133.0085b","name":"tf pool camera?","server":"8b52884a.b76658","halt_if":"0","halt_if_type":"num","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"image_processing.tensorflow_pool","state_type":"num","outputs":2,"x":1180,"y":740,"wires":[["9b6a1a6b.8b7b98"],[]]},{"id":"9b6a1a6b.8b7b98","type":"api-call-service","z":"ea946133.0085b","name":"Notify Slack","server":"8b52884a.b76658","service_domain":"notify","service":"slack","data":"{\"message\":\"Pool Camera Motion Alert\",\"title\":\"pool_latest.jpg\",\"data\":{\"file\":{\"path\":\"/config/www/tensorflow/snapshot/pool_latest.jpg\"}}}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1410,"y":740,"wires":[[]]},{"id":"9abe3eba.7a1c7","type":"api-call-service","z":"ea946133.0085b","name":"tf driveway camera","server":"8b52884a.b76658","service_domain":"image_processing","service":"scan","data":"{\"entity_id\":\"image_processing.tensorflow_driveway\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":910,"y":460,"wires":[["d3b6aeca.7899d"]]},{"id":"d3b6aeca.7899d","type":"api-current-state","z":"ea946133.0085b","name":"tf driveway camera?","server":"8b52884a.b76658","halt_if":"0","halt_if_type":"num","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"image_processing.tensorflow_driveway","state_type":"num","outputs":2,"x":1200,"y":460,"wires":[["55251439.061cdc"],[]]},{"id":"55251439.061cdc","type":"api-call-service","z":"ea946133.0085b","name":"Notify Slack","server":"8b52884a.b76658","service_domain":"notify","service":"slack","data":"{\"message\":\"Driveway Camera Motion Alert\",\"title\":\"driveway_latest.jpg\",\"data\":{\"file\":{\"path\":\"/config/www/tensorflow/snapshot/driveway_latest.jpg\"}}}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1410,"y":460,"wires":[[]]},{"id":"246aae0.b493f52","type":"api-call-service","z":"ea946133.0085b","name":"tf porch camera","server":"8b52884a.b76658","service_domain":"image_processing","service":"scan","data":"{\"entity_id\":\"image_processing.tensorflow_porch\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":900,"y":200,"wires":[["624662b5.fbb90c"]]},{"id":"624662b5.fbb90c","type":"api-current-state","z":"ea946133.0085b","name":"tf porch camera?","server":"8b52884a.b76658","halt_if":"0","halt_if_type":"num","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"image_processing.tensorflow_porch","state_type":"num","outputs":2,"x":1190,"y":200,"wires":[["449b3a49.f2e934"],[]]},{"id":"449b3a49.f2e934","type":"api-call-service","z":"ea946133.0085b","name":"Notify Slack","server":"8b52884a.b76658","service_domain":"notify","service":"slack","data":"{\"message\":\"Porch Camera Motion Alert\",\"title\":\"porch_latest.jpg\",\"data\":{\"file\":{\"path\":\"/config/www/tensorflow/snapshot/porch_latest.jpg\"}}}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1410,"y":200,"wires":[[]]},{"id":"aa7a14fb.bcc2a8","type":"api-call-service","z":"ea946133.0085b","name":"tf front camera","server":"8b52884a.b76658","service_domain":"image_processing","service":"scan","data":"{\"entity_id\":\"image_processing.tensorflow_front\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":900,"y":60,"wires":[["b550a272.e11ee"]]},{"id":"b550a272.e11ee","type":"api-current-state","z":"ea946133.0085b","name":"tf front camera?","server":"8b52884a.b76658","halt_if":"0","halt_if_type":"num","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"image_processing.tensorflow_front","state_type":"num","outputs":2,"x":1180,"y":60,"wires":[["4e8cc8a3.fe5658"],[]]},{"id":"4e8cc8a3.fe5658","type":"api-call-service","z":"ea946133.0085b","name":"Notify Slack","server":"8b52884a.b76658","service_domain":"notify","service":"slack","data":"{\"message\":\"Front Camera Motion Alert\",\"title\":\"front_latest.jpg\",\"data\":{\"file\":{\"path\":\"/config/www/tensorflow/snapshot/front_latest.jpg\"}}}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1410,"y":60,"wires":[[]]},{"id":"be993a9b.fa2da8","type":"time-range-switch","z":"ea946133.0085b","name":"10pm-6am","lat":"33.95092","lon":"-84.44805","startTime":"22:00","endTime":"06:00","startOffset":0,"endOffset":0,"x":690,"y":280,"wires":[["246aae0.b493f52","fecab8f7.aa5b18"],[]]},{"id":"1457ac16.ec37e4","type":"time-range-switch","z":"ea946133.0085b","name":"10pm-6am","lat":"33.95092","lon":"-84.44805","startTime":"22:00","endTime":"06:00","startOffset":0,"endOffset":0,"x":690,"y":820,"wires":[["6c431925.fa56b8","d3be975d.234b68"],[]]},{"id":"46cdb220.d99dbc","type":"mqtt out","z":"9143c7f2.16df18","name":"trigger arrival scan","topic":"monitor/scan/arrive","qos":"","retain":"","broker":"649859a4.a17818","x":1190,"y":680,"wires":[]},{"id":"5b3f844.f2cf77c","type":"mqtt out","z":"9143c7f2.16df18","name":"trigger departure scan","topic":"monitor/scan/depart","qos":"","retain":"","broker":"649859a4.a17818","x":1200,"y":220,"wires":[]},{"id":"53603f27.a87b3","type":"server-state-changed","z":"9143c7f2.16df18","name":"sliding door open?","server":"8b52884a.b76658","entityidfilter":"binary_sensor.sliding_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":230,"y":440,"wires":[["52a680e.b58558","fe1f1f4a.3f5bc"],[]]},{"id":"8acbd984.50cab8","type":"server-state-changed","z":"9143c7f2.16df18","name":"sun-room door open?","server":"8b52884a.b76658","entityidfilter":"binary_sensor.sun_room_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":220,"y":500,"wires":[["fe1f1f4a.3f5bc","52a680e.b58558"],[]]},{"id":"14f56181.1b2ffe","type":"server-state-changed","z":"9143c7f2.16df18","name":"front door open?","server":"8b52884a.b76658","entityidfilter":"binary_sensor.front_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":240,"y":560,"wires":[["fe1f1f4a.3f5bc","52a680e.b58558"],[]]},{"id":"e2bb16da.b2bc68","type":"server-state-changed","z":"9143c7f2.16df18","name":"basement door open?","server":"8b52884a.b76658","entityidfilter":"binary_sensor.basement_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":220,"y":620,"wires":[["fe1f1f4a.3f5bc","52a680e.b58558"],[]]},{"id":"a1b717c7.bed8e8","type":"server-state-changed","z":"9143c7f2.16df18","name":"garage door open?","server":"8b52884a.b76658","entityidfilter":"binary_sensor.garage_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":230,"y":680,"wires":[["fe1f1f4a.3f5bc","d7acbe2a.ab111"],[]]},{"id":"fe1f1f4a.3f5bc","type":"api-current-state","z":"9143c7f2.16df18","name":"not home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":950,"y":680,"wires":[["46cdb220.d99dbc"],[]]},{"id":"16f12e62.2031d2","type":"api-current-state","z":"9143c7f2.16df18","name":"home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":930,"y":220,"wires":[["5b3f844.f2cf77c"],[]]},{"id":"e2f343b.68adbc","type":"api-call-service","z":"75b62c93.dd5d84","name":"notify jeff iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jeffs_xs","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1440,"y":100,"wires":[[]]},{"id":"eb2d3623.194588","type":"api-call-service","z":"75b62c93.dd5d84","name":"notify jen iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jennifers_xs_max","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1440,"y":220,"wires":[[]]},{"id":"f9971550.66b808","type":"poll-state","z":"2fad043e.317c8c","name":"","server":"8b52884a.b76658","updateinterval":"10","outputinitially":true,"outputonchanged":true,"entity_id":"cover.jen_garage_door","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":210,"y":100,"wires":[[]]},{"id":"717193c9.50b80c","type":"poll-state","z":"2fad043e.317c8c","name":"","server":"8b52884a.b76658","updateinterval":"10","outputinitially":true,"outputonchanged":true,"entity_id":"cover.jeff_garage_door","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":210,"y":160,"wires":[[]]},{"id":"9e95fe2d.47e3b","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's garage door open -> closed","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"5vfaipig414","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"},{"id":"27umjiospq7","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":280,"wires":[[],[]]},{"id":"209e019f.d3994e","type":"function","z":"2fad043e.317c8c","name":"garage door closed for > 5 mins?","func":"var minsToCheck = 5;\nvar minutesInMs = 60000;\nvar openTimeinMS = global.get('cover.jen_garage_door.closedTimeinMS') || 0;\nif (openTimeinMS >= (minutesInMs*minsToCheck) && msg.payload === \"closed\") {\n   msg.payload = millisecondsToStr(openTimeinMS)\n   return [ msg ];\n}\n\n\nfunction millisecondsToStr (milliseconds) {\n    // TIP: to find current time in milliseconds, use:\n    // var  current_time_milliseconds = new Date().getTime();\n\n    function numberEnding (number) {\n        return (number > 1) ? 's' : '';\n    }\n\n    var temp = Math.floor(milliseconds / 1000);\n    var years = Math.floor(temp / 31536000);\n    if (years) {\n        return years + ' year' + numberEnding(years);\n    }\n    //TODO: Months! Maybe weeks? \n    var days = Math.floor((temp %= 31536000) / 86400);\n    if (days) {\n        return days + ' day' + numberEnding(days);\n    }\n    var hours = Math.floor((temp %= 86400) / 3600);\n    if (hours) {\n        return hours + ' hour' + numberEnding(hours);\n    }\n    var minutes = Math.floor((temp %= 3600) / 60);\n    if (minutes) {\n        return minutes + ' minute' + numberEnding(minutes);\n    }\n    var seconds = temp % 60;\n    if (seconds) {\n        return seconds + ' second' + numberEnding(seconds);\n    }\n    return 'less than a second'; //'just now' //or other string you like;\n}","outputs":1,"noerr":0,"x":900,"y":340,"wires":[["761ad3eb.80eb6c"]]},{"id":"bea4a801.9f6cc8","type":"function","z":"2fad043e.317c8c","name":"reset jens garage door closed timer","func":"global.set('cover.jen_garage_door.closedTimeinMS',0);\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":280,"wires":[["6e7d8be1.205d04"]]},{"id":"6e7d8be1.205d04","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":830,"y":280,"wires":[]},{"id":"814a7aa3.a517e8","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's garage door closed?","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"5vfaipig414","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"},{"id":"jqxehrylwml","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":340,"wires":[[],[]]},{"id":"22b6bdb.37aed42","type":"function","z":"2fad043e.317c8c","name":"capture & add current closed time","func":"var currentSavedTime = global.get('cover.jen_garage_door.closedTimeinMS') || 0;\nglobal.set('cover.jen_garage_door.closedTimeinMS', Math.abs(msg.data.event.new_state.timeSinceChangedMs - currentSavedTime) + currentSavedTime);\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":340,"wires":[["209e019f.d3994e"]]},{"id":"761ad3eb.80eb6c","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1150,"y":340,"wires":[]},{"id":"e1917b2b.6060b8","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's garage door closed -> open","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7ssscforb0o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"ca2smqkbbur","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":420,"wires":[[],[]]},{"id":"21c9b96d.62eae6","type":"function","z":"2fad043e.317c8c","name":"garage door open for > 10 mins?","func":"var minsToCheck = 10;\nvar minutesInMs = 60000;\nvar openTimeinMS = global.get('cover.jen_garage_door.openTimeinMS') || 0;\nif (openTimeinMS >= (minutesInMs*minsToCheck) && msg.payload === \"open\") {\n   msg.payload = millisecondsToStr(openTimeinMS)\n   return [ msg ];\n}\n\n\nfunction millisecondsToStr (milliseconds) {\n    // TIP: to find current time in milliseconds, use:\n    // var  current_time_milliseconds = new Date().getTime();\n\n    function numberEnding (number) {\n        return (number > 1) ? 's' : '';\n    }\n\n    var temp = Math.floor(milliseconds / 1000);\n    var years = Math.floor(temp / 31536000);\n    if (years) {\n        return years + ' year' + numberEnding(years);\n    }\n    //TODO: Months! Maybe weeks? \n    var days = Math.floor((temp %= 31536000) / 86400);\n    if (days) {\n        return days + ' day' + numberEnding(days);\n    }\n    var hours = Math.floor((temp %= 86400) / 3600);\n    if (hours) {\n        return hours + ' hour' + numberEnding(hours);\n    }\n    var minutes = Math.floor((temp %= 3600) / 60);\n    if (minutes) {\n        return minutes + ' minute' + numberEnding(minutes);\n    }\n    var seconds = temp % 60;\n    if (seconds) {\n        return seconds + ' second' + numberEnding(seconds);\n    }\n    return 'less than a second'; //'just now' //or other string you like;\n}","outputs":1,"noerr":0,"x":900,"y":480,"wires":[["969ccaba.6e0c78"]]},{"id":"bc976ef9.e301c","type":"function","z":"2fad043e.317c8c","name":"reset jens garage door open timer","func":"global.set('cover.jen_garage_door.openTimeinMS',0);\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":420,"wires":[["335ee75c.cd9da8"]]},{"id":"335ee75c.cd9da8","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":830,"y":420,"wires":[]},{"id":"a4f31f.d9d5ace","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's garage door open?","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"03b4hq1eehkp","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"9b1umrt4zg4","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":480,"wires":[[],[]]},{"id":"ae423f3b.c222c","type":"function","z":"2fad043e.317c8c","name":"capture & add current open time","func":"var currentSavedTime = global.get('cover.jen_garage_door.openTimeinMS') || 0;\nglobal.set('cover.jen_garage_door.openTimeinMS', Math.abs(msg.data.event.new_state.timeSinceChangedMs - currentSavedTime) + currentSavedTime);\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":480,"wires":[["21c9b96d.62eae6"]]},{"id":"969ccaba.6e0c78","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1150,"y":480,"wires":[]},{"id":"2e7d95d4.cab80a","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's garage door open -> closed","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"5vfaipig414","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"},{"id":"27umjiospq7","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":580,"wires":[[],[]]},{"id":"bbd7b67.ad33648","type":"function","z":"2fad043e.317c8c","name":"garage door closed for > 10 mins?","func":"var minsToCheck = 10;\nvar minutesInMs = 60000;\nvar openTimeinMS = global.get('cover.jeff_garage_door.closedTimeinMS') || 0;\nif (openTimeinMS >= (minutesInMs*minsToCheck) && msg.payload === \"closed\") {\n   msg.payload = millisecondsToStr(openTimeinMS)\n   return [ msg ];\n}\n\n\nfunction millisecondsToStr (milliseconds) {\n    // TIP: to find current time in milliseconds, use:\n    // var  current_time_milliseconds = new Date().getTime();\n\n    function numberEnding (number) {\n        return (number > 1) ? 's' : '';\n    }\n\n    var temp = Math.floor(milliseconds / 1000);\n    var years = Math.floor(temp / 31536000);\n    if (years) {\n        return years + ' year' + numberEnding(years);\n    }\n    //TODO: Months! Maybe weeks? \n    var days = Math.floor((temp %= 31536000) / 86400);\n    if (days) {\n        return days + ' day' + numberEnding(days);\n    }\n    var hours = Math.floor((temp %= 86400) / 3600);\n    if (hours) {\n        return hours + ' hour' + numberEnding(hours);\n    }\n    var minutes = Math.floor((temp %= 3600) / 60);\n    if (minutes) {\n        return minutes + ' minute' + numberEnding(minutes);\n    }\n    var seconds = temp % 60;\n    if (seconds) {\n        return seconds + ' second' + numberEnding(seconds);\n    }\n    return 'less than a second'; //'just now' //or other string you like;\n}","outputs":1,"noerr":0,"x":900,"y":640,"wires":[["f3cb12aa.eb18c"]]},{"id":"11ba2469.e3f64c","type":"function","z":"2fad043e.317c8c","name":"reset jeffs garage door closed timer","func":"global.set('cover.jeff_garage_door.closedTimeinMS',0);\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":580,"wires":[["4cabb4ae.0d218c"]]},{"id":"4cabb4ae.0d218c","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":830,"y":580,"wires":[]},{"id":"be2421c6.ad1b1","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's garage door closed?","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"5vfaipig414","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"},{"id":"ozukcporgrf","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":640,"wires":[[],[]]},{"id":"188011d5.077b8e","type":"function","z":"2fad043e.317c8c","name":"capture & add current closed time","func":"var currentSavedTime = global.get('cover.jeff_garage_door.closedTimeinMS') || 0;\nglobal.set('cover.jeff_garage_door.closedTimeinMS', Math.abs(msg.data.event.new_state.timeSinceChangedMs - currentSavedTime) + currentSavedTime);\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":640,"wires":[["bbd7b67.ad33648"]]},{"id":"f3cb12aa.eb18c","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1150,"y":640,"wires":[]},{"id":"5ec3e16b.b26b3","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's garage door closed -> open","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7ssscforb0o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"ca2smqkbbur","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":720,"wires":[[],[]]},{"id":"670deb94.a38f94","type":"function","z":"2fad043e.317c8c","name":"garage door open for > 10 mins?","func":"var minsToCheck = 10;\nvar minutesInMs = 60000;\nvar openTimeinMS = global.get('cover.jeff_garage_door.openTimeinMS') || 0;\nif (openTimeinMS >= (minutesInMs*minsToCheck) && msg.payload === \"open\") {\n   msg.payload = millisecondsToStr(openTimeinMS)\n   return [ msg ];\n}\n\n\nfunction millisecondsToStr (milliseconds) {\n    // TIP: to find current time in milliseconds, use:\n    // var  current_time_milliseconds = new Date().getTime();\n\n    function numberEnding (number) {\n        return (number > 1) ? 's' : '';\n    }\n\n    var temp = Math.floor(milliseconds / 1000);\n    var years = Math.floor(temp / 31536000);\n    if (years) {\n        return years + ' year' + numberEnding(years);\n    }\n    //TODO: Months! Maybe weeks? \n    var days = Math.floor((temp %= 31536000) / 86400);\n    if (days) {\n        return days + ' day' + numberEnding(days);\n    }\n    var hours = Math.floor((temp %= 86400) / 3600);\n    if (hours) {\n        return hours + ' hour' + numberEnding(hours);\n    }\n    var minutes = Math.floor((temp %= 3600) / 60);\n    if (minutes) {\n        return minutes + ' minute' + numberEnding(minutes);\n    }\n    var seconds = temp % 60;\n    if (seconds) {\n        return seconds + ' second' + numberEnding(seconds);\n    }\n    return 'less than a second'; //'just now' //or other string you like;\n}","outputs":1,"noerr":0,"x":900,"y":780,"wires":[["33b0d59a.f3ff0a"]]},{"id":"1f41324d.ff075e","type":"function","z":"2fad043e.317c8c","name":"reset jeff garage door open timer","func":"global.set('cover.jeff_garage_door.openTimeinMS',0);\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":720,"wires":[["f37fd716.72e5f8"]]},{"id":"f37fd716.72e5f8","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":830,"y":720,"wires":[]},{"id":"6deda104.38775","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's garage door open?","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"03b4hq1eehkp","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"tle0bbbbad","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":780,"wires":[[],[]]},{"id":"934edc1c.267bd","type":"function","z":"2fad043e.317c8c","name":"capture & add current open time","func":"var currentSavedTime = global.get('cover.jeff_garage_door.openTimeinMS') || 0;\nglobal.set('cover.jeff_garage_door.openTimeinMS', Math.abs(msg.data.event.new_state.timeSinceChangedMs - currentSavedTime) + currentSavedTime);\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":780,"wires":[["670deb94.a38f94"]]},{"id":"33b0d59a.f3ff0a","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1150,"y":780,"wires":[]},{"id":"1e1c0d7e.a68d03","type":"inject","z":"2fad043e.317c8c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":540,"wires":[["bc976ef9.e301c","bea4a801.9f6cc8","11ba2469.e3f64c","1f41324d.ff075e"]]},{"id":"9c97bcf0.cc525","type":"pushover api","z":"2fad043e.317c8c","keys":"1be7789.845ca87","title":"","name":"","x":340,"y":1340,"wires":[]},{"id":"9d177358.52fa5","type":"function","z":"2fad043e.317c8c","name":"pushover payload (frigate)","func":"msg.topic = \"Person Detected (frigate)\";\nmsg.payload = \"Porch\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"http://k8s-4:5000/porch/best_person.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":590,"y":1080,"wires":[[]]},{"id":"773c4cee.01cb04","type":"function","z":"2fad043e.317c8c","name":"pushover payload (frigate)","func":"msg.topic = \"Person Detected (frigate)\";\nmsg.payload = \"Driveway\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"http://k8s-4:5000/driveway/best_person.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":590,"y":1140,"wires":[[]]},{"id":"84d264de.6d8a68","type":"function","z":"2fad043e.317c8c","name":"pushover payload (frigate)","func":"msg.topic = \"Person Detected (frigate)\";\nmsg.payload = \"Front\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"http://k8s-4:5000/front/best_person.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":590,"y":1020,"wires":[[]]},{"id":"7ef5891a.b8bc68","type":"function","z":"2fad043e.317c8c","name":"pushover payload (frigate)","func":"msg.topic = \"Person Detected (frigate)\";\nmsg.payload = \"Pool\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"http://k8s-4:5000/pool/best_person.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":590,"y":1200,"wires":[[]]},{"id":"31992598.4bd18a","type":"function","z":"2fad043e.317c8c","name":"pushover payload (frigate)","func":"msg.topic = \"Person Detected (frigate)\";\nmsg.payload = \"Basement\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"http://k8s-4:5000/basement/best_person.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":590,"y":1260,"wires":[[]]},{"id":"b0b84fff.f8d14","type":"api-current-state","z":"2fad043e.317c8c","name":"not home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":150,"y":1340,"wires":[[],[]]},{"id":"5319a7a5.1e0138","type":"mqtt in","z":"2fad043e.317c8c","name":"Basement Camera (BI)","topic":"BlueIris/alert/basement","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":180,"y":1260,"wires":[["70260327.9f0f6c"]]},{"id":"70260327.9f0f6c","type":"switch","z":"2fad043e.317c8c","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":1260,"wires":[[]]},{"id":"60dde288.63d11c","type":"function","z":"2fad043e.317c8c","name":"pushover payload (hass)","func":"msg.topic = \"Person Detected\";\nmsg.payload = \"Basement\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"https://hass.eviljungle.com/local/tensorflow/snapshot/basement_latest.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":850,"y":1260,"wires":[[]]},{"id":"e4d9e9e8.5f2668","type":"mqtt in","z":"2fad043e.317c8c","name":"Pool Camera (BI)","topic":"BlueIris/alert/pool","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":160,"y":1200,"wires":[["f79436e7.296b28"]]},{"id":"f79436e7.296b28","type":"switch","z":"2fad043e.317c8c","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":1200,"wires":[[]]},{"id":"7522cacd.6915e4","type":"function","z":"2fad043e.317c8c","name":"pushover payload (hass)","func":"msg.topic = \"Person Detected\";\nmsg.payload = \"Pool\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"https://hass.eviljungle.com/local/tensorflow/snapshot/pool_latest.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":850,"y":1200,"wires":[[]]},{"id":"d0145ca5.75af3","type":"mqtt in","z":"2fad043e.317c8c","name":"Driveway Camera (BI)","topic":"BlueIris/alert/driveway","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":180,"y":1140,"wires":[["1b81c37e.528dad"]]},{"id":"1b81c37e.528dad","type":"switch","z":"2fad043e.317c8c","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":1140,"wires":[[]]},{"id":"49116105.c024c","type":"function","z":"2fad043e.317c8c","name":"pushover payload (hass)","func":"msg.topic = \"Person Detected\";\nmsg.payload = \"Driveway\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"https://hass.eviljungle.com/local/tensorflow/snapshot/driveway_latest.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":850,"y":1140,"wires":[[]]},{"id":"ca7bf332.0c743","type":"mqtt in","z":"2fad043e.317c8c","name":"Porch Camera (BI)","topic":"BlueIris/alert/porch","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":170,"y":1080,"wires":[["8db8621e.17aaf"]]},{"id":"8db8621e.17aaf","type":"switch","z":"2fad043e.317c8c","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":1080,"wires":[[]]},{"id":"177acca2.5b81c3","type":"function","z":"2fad043e.317c8c","name":"pushover payload (hass)","func":"msg.topic = \"Person Detected\";\nmsg.payload = \"Porch\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"https://hass.eviljungle.com/local/tensorflow/snapshot/porch_latest.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":850,"y":1080,"wires":[[]]},{"id":"436c43b4.19d48c","type":"mqtt in","z":"2fad043e.317c8c","name":"Front Camera (BI)","topic":"BlueIris/alert/front","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":160,"y":1020,"wires":[["cd7cb133.06abc"]]},{"id":"cd7cb133.06abc","type":"switch","z":"2fad043e.317c8c","name":"motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":1020,"wires":[[]]},{"id":"39c37970.6dd626","type":"function","z":"2fad043e.317c8c","name":"pushover payload (hass)","func":"msg.topic = \"Person Detected\";\nmsg.payload = \"Front\";\nmsg.sound = \"intermission\"\nmsg.priority = 1;\nmsg.image = \"https://hass.eviljungle.com/local/tensorflow/snapshot/front_latest.jpg\"\nreturn msg;\n","outputs":1,"noerr":0,"x":850,"y":1020,"wires":[[]]},{"id":"884946fa.65a098","type":"comment","z":"2fad043e.317c8c","name":"Old stuff","info":"","x":140,"y":960,"wires":[]},{"id":"1bf8db6a.31e655","type":"api-current-state","z":"ea946133.0085b","name":"not home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":690,"y":460,"wires":[["69e6676b.787a18","9abe3eba.7a1c7"],["74bd3f2f.925bb"]]},{"id":"857f47d0.3b4578","type":"server-state-changed","z":"2fad043e.317c8c","name":"Jen's Garage Door Opening","server":"8b52884a.b76658","entityidfilter":"sensor.garage2_status","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"Opening","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"x":540,"y":60,"wires":[[],[]]},{"id":"5c0b449c.02fbac","type":"server-state-changed","z":"2fad043e.317c8c","name":"Jeff's Garage Door Opening","server":"8b52884a.b76658","entityidfilter":"sensor.garage_status","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"Opening","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"x":540,"y":120,"wires":[[],[]]},{"id":"d6999820.055628","type":"server-state-changed","z":"2fad043e.317c8c","name":"Jen's Garage Door Closing","server":"8b52884a.b76658","entityidfilter":"sensor.garage2_status","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"Closing","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"x":530,"y":180,"wires":[[],[]]},{"id":"b4e5e07d.3a0d2","type":"server-state-changed","z":"2fad043e.317c8c","name":"Jen's Garage Door Closing","server":"8b52884a.b76658","entityidfilter":"sensor.garage2_status","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"Closing","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"x":530,"y":240,"wires":[[],[]]},{"id":"40113f5b.a57a5","type":"server-state-changed","z":"ea946133.0085b","name":"basement door open?","server":"8b52884a.b76658","entityidfilter":"binary_sensor.basement_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":140,"y":1000,"wires":[["7365e499.488e4c"],[]]},{"id":"1104f7d2.7a2938","type":"function","z":"4aedf9e8.044e08","name":"Alarm iOS msg","func":"var action = msg.payload\n\nvar category = \"alarm\"\nvar title = \"Alarm System\"\nvar message = \"Alarm is now \" + action\n\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":920,"y":500,"wires":[["aeafe637.1aeaf8","f27a9952.dc7b18"]]},{"id":"aeafe637.1aeaf8","type":"api-call-service","z":"4aedf9e8.044e08","name":"notify jeff iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jeffs_xs","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1240,"y":500,"wires":[[]]},{"id":"199cf4c0.bebdbb","type":"api-call-service","z":"4aedf9e8.044e08","name":"Notify Slack","server":"8b52884a.b76658","service_domain":"notify","service":"slack","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1230,"y":620,"wires":[[]]},{"id":"42e3cc92.5ddb44","type":"function","z":"4aedf9e8.044e08","name":"Alarm slack msg","func":"var action = msg.payload\n\nvar title = \"Alarm System\"\nvar message = \"Alarm is now \" + action\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":920,"y":560,"wires":[["199cf4c0.bebdbb"]]},{"id":"f27a9952.dc7b18","type":"api-call-service","z":"4aedf9e8.044e08","name":"notify jen iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jennifers_xs_max","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1240,"y":560,"wires":[[]]},{"id":"3700839b.3d543c","type":"server-state-changed","z":"4aedf9e8.044e08","name":"Alarm Triggered","server":"8b52884a.b76658","entityidfilter":"alarm_control_panel.alarm_panel","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"triggered","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"x":140,"y":700,"wires":[["cca292a3.05942"],[]]},{"id":"32667083.17f79","type":"function","z":"4aedf9e8.044e08","name":"Alarm Triggerred iOS msg","func":"var action = msg.payload\n\nvar category = \"alarm\"\nvar title = \" ALARM TRIGGERED! \"\nvar message = \"THE ALARM HAS TRIGGERED! OMG WTFBBQ!!!!111  \\n\" + action\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Vacate-The-Premises.wav\",\n                badge: 5\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":950,"y":700,"wires":[["aeafe637.1aeaf8","f27a9952.dc7b18"]]},{"id":"c7ea6dcc.c22e4","type":"function","z":"4aedf9e8.044e08","name":"Alarm Triggerred slack msg","func":"var action = msg.payload\nvar message = \"@here  ALARM HAS TRIGGERED \\n\" + action + \" \\n OMG WTFBBQ!!!!!11 :fire:\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        // data: {\n        //     attachments: [\n        //         {\n        //             title: \"Front Camera\",\n        //             image_url: \"https://hass.eviljungle.com/local/camera/camera.front.jpg\"\n        //         },\n        //         {\n        //             title: \"Driveway Camera\",\n        //             image_url: \"https://hass.eviljungle.com/local/camera/camera.driveway.jpg\"\n        //         },\n        //         {\n        //             title: \"Porch Camera\",\n        //             image_url: \"https://hass.eviljungle.com/local/camera/camera.porch.jpg\"\n        //         },\n        //         {\n        //             title: \"Pool Camera\",\n        //             image_url: \"https://hass.eviljungle.com/local/camera/camera.pool.jpg\"\n        //         },\n        //         {\n        //             title: \"Basement Camera\",\n        //             image_url: \"https://hass.eviljungle.com/local/camera/camera.basement.jpg\"\n        //         },\n        //         ]\n        // }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":960,"y":740,"wires":[["199cf4c0.bebdbb"]]},{"id":"20800e94.dc37f2","type":"api-current-state","z":"4aedf9e8.044e08","name":"Alarm Panel Display","server":"8b52884a.b76658","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.alarm_panel_display","state_type":"str","outputs":1,"x":680,"y":700,"wires":[["dbaa0a2e.d4c668","3c2430e1.ba8e3","8cbf255e.433118","c0e06a86.1980c8","e2b8a6e2.e4fdc8","32667083.17f79","c7ea6dcc.c22e4"]]},{"id":"dbaa0a2e.d4c668","type":"function","z":"4aedf9e8.044e08","name":"trigger basement camera (BI)","func":"msg.payload = \"camera=basement&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":960,"y":960,"wires":[["99152e82.75a54"]]},{"id":"e2b8a6e2.e4fdc8","type":"function","z":"4aedf9e8.044e08","name":"trigger pool camera (BI)","func":"msg.payload = \"camera=pool&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":950,"y":920,"wires":[["99152e82.75a54"]]},{"id":"c0e06a86.1980c8","type":"function","z":"4aedf9e8.044e08","name":"trigger driveway camera (BI)","func":"msg.payload = \"camera=driveway&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":960,"y":880,"wires":[["99152e82.75a54"]]},{"id":"8cbf255e.433118","type":"function","z":"4aedf9e8.044e08","name":"trigger porch camera (BI)","func":"msg.payload = \"camera=porch&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":950,"y":840,"wires":[["99152e82.75a54"]]},{"id":"3c2430e1.ba8e3","type":"function","z":"4aedf9e8.044e08","name":"trigger front camera (BI)","func":"msg.payload = \"camera=front&trigger\";\nreturn msg;\n","outputs":1,"noerr":0,"x":950,"y":800,"wires":[["99152e82.75a54"]]},{"id":"99152e82.75a54","type":"mqtt out","z":"4aedf9e8.044e08","name":"trigger blue iris","topic":"BlueIris/admin","qos":"","retain":"","broker":"649859a4.a17818","x":1240,"y":880,"wires":[]},{"id":"7cf2a0d2.f39ae","type":"api-current-state","z":"4aedf9e8.044e08","name":"not home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":550,"y":500,"wires":[["fe046407.ab0868"],[]]},{"id":"71941591.c8558c","type":"trigger-state","z":"4aedf9e8.044e08","name":"home -> not_home","server":"8b52884a.b76658","entityid":"sensor.anyone_home","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"m9qiqujd83","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"not_home"},{"id":"wl8tjeww34","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":130,"y":200,"wires":[["ccda8ca7.269df"],[]]},{"id":"ccda8ca7.269df","type":"api-current-state","z":"4aedf9e8.044e08","name":"run?","server":"8b52884a.b76658","halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_arm_alarm_when_gone","state_type":"str","outputs":2,"x":350,"y":200,"wires":[["513f0dbe.940124"],[]]},{"id":"892a8bfd.69c738","type":"credentials","z":"4aedf9e8.044e08","name":"alarm code","props":[{"value":"alarm_code","type":"msg"}],"x":990,"y":200,"wires":[["c901e347.7a1dc"]]},{"id":"c901e347.7a1dc","type":"api-call-service","z":"4aedf9e8.044e08","name":"arm alarm","server":"8b52884a.b76658","service_domain":"alarm_control_panel","service":"alarm_arm_night","data":"{\"entity_id\":\"alarm_control_panel.alarm_panel\",\"code\":\"{{ alarm_code }}\"}","render_data":true,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1180,"y":200,"wires":[[]]},{"id":"d530f3f1.e8195","type":"trigger-state","z":"4aedf9e8.044e08","name":"not_home -> home","server":"8b52884a.b76658","entityid":"sensor.anyone_home","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"n16bzdqj6p","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"1cv3kmbt40v","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"not_home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":130,"y":380,"wires":[["7f300b61.5a4044"],[]]},{"id":"7f300b61.5a4044","type":"api-current-state","z":"4aedf9e8.044e08","name":"run?","server":"8b52884a.b76658","halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_disarm_alarm_when_home","state_type":"str","outputs":2,"x":350,"y":380,"wires":[["f57054d6.5fd878"],[]]},{"id":"81c2d258.033ce","type":"credentials","z":"4aedf9e8.044e08","name":"alarm code","props":[{"value":"alarm_code","type":"msg"}],"x":990,"y":380,"wires":[["d837e04d.b2546"]]},{"id":"d837e04d.b2546","type":"api-call-service","z":"4aedf9e8.044e08","name":"disarm alarm","server":"8b52884a.b76658","service_domain":"alarm_control_panel","service":"alarm_disarm","data":"{\"entity_id\":\"alarm_control_panel.alarm_panel\",\"code\":\"{{ alarm_code }}\"}","render_data":true,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1190,"y":380,"wires":[[]]},{"id":"3d0081db.06ffce","type":"api-current-state","z":"4aedf9e8.044e08","name":"run?","server":"8b52884a.b76658","halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.notify_alarm_armed","state_type":"str","outputs":2,"x":350,"y":500,"wires":[["7cf2a0d2.f39ae","9e7b18fc.02bc08"],[]]},{"id":"7c85f3a.d00500c","type":"api-current-state","z":"4aedf9e8.044e08","name":"run?","server":"8b52884a.b76658","halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.notify_alarm_disarmed","state_type":"str","outputs":2,"x":350,"y":560,"wires":[["7cf2a0d2.f39ae","9e7b18fc.02bc08"],[]]},{"id":"cca292a3.05942","type":"api-current-state","z":"4aedf9e8.044e08","name":"run?","server":"8b52884a.b76658","halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.notify_alarm_triggered","state_type":"str","outputs":2,"x":350,"y":700,"wires":[["20800e94.dc37f2"],[]]},{"id":"513f0dbe.940124","type":"api-current-state","z":"4aedf9e8.044e08","name":"alarm automatic mode?","server":"8b52884a.b76658","halt_if":"automatic","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_select.alarm_mode","state_type":"str","outputs":2,"x":590,"y":200,"wires":[["892a8bfd.69c738"],[]]},{"id":"f57054d6.5fd878","type":"api-current-state","z":"4aedf9e8.044e08","name":"alarm automatic mode?","server":"8b52884a.b76658","halt_if":"automatic","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_select.alarm_mode","state_type":"str","outputs":2,"x":590,"y":380,"wires":[["81c2d258.033ce"],[]]},{"id":"fe046407.ab0868","type":"api-current-state","z":"4aedf9e8.044e08","name":"Alarm Status","server":"8b52884a.b76658","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"alarm_control_panel.alarm_panel","state_type":"str","outputs":1,"x":730,"y":500,"wires":[["1104f7d2.7a2938"]]},{"id":"9e7b18fc.02bc08","type":"api-current-state","z":"4aedf9e8.044e08","name":"Alarm Status","server":"8b52884a.b76658","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"alarm_control_panel.alarm_panel","state_type":"str","outputs":1,"x":730,"y":560,"wires":[["42e3cc92.5ddb44"]]},{"id":"a3022d37.abad7","type":"inject","z":"9143c7f2.16df18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":960,"y":280,"wires":[["5b3f844.f2cf77c"]]},{"id":"8200a719.646368","type":"inject","z":"9143c7f2.16df18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":960,"y":740,"wires":[["46cdb220.d99dbc"]]},{"id":"1ab168ac.d3e527","type":"trigger-state","z":"4aedf9e8.044e08","name":"Alarm Disarmed","server":"8b52884a.b76658","entityid":"alarm_control_panel.alarm_panel","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"u92ykgxcnd","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"disarmed"},{"id":"2vhxcfx6q13","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"disarmed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":140,"y":560,"wires":[["7c85f3a.d00500c"],[]]},{"id":"cea06a40.728948","type":"trigger-state","z":"4aedf9e8.044e08","name":"Alarm Armed","server":"8b52884a.b76658","entityid":"alarm_control_panel.alarm_panel","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"ty01v74n8h","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"re","comparatorValue":"^armed.*"},{"id":"i15iybgnzt","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is_not","comparatorValueDatatype":"re","comparatorValue":"^armed.*"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":150,"y":500,"wires":[["3d0081db.06ffce"],[]]},{"id":"84269af4.ae7e98","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":670,"y":1620,"wires":[]},{"id":"20fb1e76.a034e2","type":"trigger-state","z":"2fad043e.317c8c","name":"Alarm Disarmed 3","server":"8b52884a.b76658","entityid":"alarm_control_panel.alarm_panel","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"v3xl7gf8glf","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"disarmed"},{"id":"lfj0hpkx9i8","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"re","comparatorValue":"^armed.*"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":1480,"wires":[["9b45867f.955ba8"],[]]},{"id":"9b45867f.955ba8","type":"debug","z":"2fad043e.317c8c","name":"test 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":440,"y":1480,"wires":[]},{"id":"1f88175.8a907e9","type":"trigger-state","z":"2fad043e.317c8c","name":"Alarm Armed 3","server":"8b52884a.b76658","entityid":"alarm_control_panel.alarm_panel","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"x6ekl8kp0e","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"disarmed"},{"id":"bfwzhu9dots","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"re","comparatorValue":"^armed.*"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":180,"y":1540,"wires":[["9b45867f.955ba8"],[]]},{"id":"44e5b3e.e1d474c","type":"server-state-changed","z":"2fad043e.317c8c","name":"Alarm Disarmed 4","server":"8b52884a.b76658","entityidfilter":"alarm_control_panel.alarm_panel","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"disarmed","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"x":170,"y":1620,"wires":[["e872230d.c5e92"],[]]},{"id":"6aeb62df.50892c","type":"server-state-changed","z":"2fad043e.317c8c","name":"Alarm Armed 4","server":"8b52884a.b76658","entityidfilter":"alarm_control_panel.alarm_panel","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"^armed.*","halt_if_type":"re","halt_if_compare":"is_not","outputs":2,"x":160,"y":1680,"wires":[["e872230d.c5e92"],[]]},{"id":"e872230d.c5e92","type":"debug","z":"2fad043e.317c8c","name":"test 4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":370,"y":1680,"wires":[]},{"id":"6becc24f.c28d6c","type":"trigger-state","z":"2fad043e.317c8c","name":"Alarm Armed","server":"8b52884a.b76658","entityid":"sensor.alarm_status","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"r22ucrgnllj","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Armed"},{"id":"06ml9kxp4abu","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Disarmed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":690,"y":1500,"wires":[[],[]]},{"id":"aca97ac6.eba0d8","type":"trigger-state","z":"2fad043e.317c8c","name":"Alarm Disarmed","server":"8b52884a.b76658","entityid":"sensor.alarm_status","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"ugytonany1","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Disarmed"},{"id":"frjli83mrw","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Armed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":680,"y":1560,"wires":[[],[]]},{"id":"630ebb83.dbc224","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jeff's phone (wifi) not_home?","server":"8b52884a.b76658","entityidfilter":"device_tracker.jeffs_xs","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":200,"y":40,"wires":[["16f12e62.2031d2"],[]]},{"id":"7caa2413.62a4fc","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jen's phone (wifi) not_home?","server":"8b52884a.b76658","entityidfilter":"device_tracker.jennifersxsmax","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":200,"y":100,"wires":[["16f12e62.2031d2"],[]]},{"id":"84f77b1c.758d08","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jeff's phone (gps) not_home?","server":"8b52884a.b76658","entityidfilter":"device_tracker.jeffs_xs_2","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":200,"y":160,"wires":[["16f12e62.2031d2"],[]]},{"id":"4d79feec.8f286","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jen's phone (gps) not_home?","server":"8b52884a.b76658","entityidfilter":"device_tracker.jennifers_xs_max","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":200,"y":220,"wires":[["16f12e62.2031d2"],[]]},{"id":"bdd3ab2a.8fef78","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jeff's phone (wifi) home?","server":"8b52884a.b76658","entityidfilter":"device_tracker.jeffs_xs","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"not_home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":210,"y":860,"wires":[["fe1f1f4a.3f5bc"],[]]},{"id":"8e0cf787.78b938","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jen's phone (wifi) home?","server":"8b52884a.b76658","entityidfilter":"device_tracker.jennifersxsmax","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"not_home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":210,"y":920,"wires":[["fe1f1f4a.3f5bc"],[]]},{"id":"90c40146.a5c44","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jeff's phone (gps) home?","server":"8b52884a.b76658","entityidfilter":"device_tracker.jeffs_xs_2","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"not_home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":210,"y":980,"wires":[["fe1f1f4a.3f5bc"],[]]},{"id":"7ac57ec8.a0491","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jen's phone (gps) home?","server":"8b52884a.b76658","entityidfilter":"device_tracker.jennifers_xs_max","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"not_home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":210,"y":1040,"wires":[["fe1f1f4a.3f5bc"],[]]},{"id":"52a680e.b58558","type":"delay","z":"9143c7f2.16df18","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":620,"y":380,"wires":[["16f12e62.2031d2"]]},{"id":"d7acbe2a.ab111","type":"delay","z":"9143c7f2.16df18","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":620,"y":440,"wires":[["16f12e62.2031d2"]]},{"id":"98c38f0a.2ef8b","type":"server-state-changed","z":"9143c7f2.16df18","name":"Someone came home","server":"8b52884a.b76658","entityidfilter":"sensor.anyone_home","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"not_home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":220,"y":1140,"wires":[["4c5a09c0.3a0ee8"],["4c5a09c0.3a0ee8"]]},{"id":"31b8c785.cc1828","type":"api-call-service","z":"9143c7f2.16df18","name":"notify jeff iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jeffs_xs","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":880,"y":1180,"wires":[[]]},{"id":"4c5a09c0.3a0ee8","type":"function","z":"9143c7f2.16df18","name":"Format iOS message","func":"var title = \"Presence\"\nvar status = msg.payload;\nvar message = \"\"\n\nif (status == \"home\") {\n    message = \"Someone came home\"\n    msg.payload = {\n        \"data\": {\n            message,\n            title,\n        }\n    }\n} else {\n    message = \"Everyone has left home\"\n    msg.payload = {\n        \"data\": {\n            message,\n            title,\n            data: {\n                push: {\n                    sound: \"US-EN-Morgan-Freeman-Welcome-Home.wav\"\n                }\n            }\n        }\n    }    \n}\nreturn [ msg ];","outputs":1,"noerr":0,"x":580,"y":1140,"wires":[["31b8c785.cc1828"]]},{"id":"4f9d09c9.24c9f8","type":"api-call-service","z":"9143c7f2.16df18","name":"notify jen iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jennifers_xs_max","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":880,"y":1240,"wires":[[]]},{"id":"9ee1346f.7bc3b8","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jeff came home","server":"8b52884a.b76658","entityidfilter":"sensor.jeff_home_status","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"False","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":240,"y":1200,"wires":[["398e9c65.547984"],[]]},{"id":"398e9c65.547984","type":"function","z":"9143c7f2.16df18","name":"Format iOS message","func":"var title = \"Presence\"\nvar message = \"Jeff came home\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n    }\n}\nreturn [ msg ];","outputs":1,"noerr":0,"x":580,"y":1200,"wires":[["31b8c785.cc1828"]]},{"id":"93e5af26.4c3cd","type":"server-state-changed","z":"9143c7f2.16df18","name":"Jen came home","server":"8b52884a.b76658","entityidfilter":"sensor.jen_home_status","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"False","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":240,"y":1260,"wires":[["787546ca.e16058"],[]]},{"id":"787546ca.e16058","type":"function","z":"9143c7f2.16df18","name":"Format iOS message","func":"var title = \"Presence\"\nvar message = \"Jen came home\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                sound: \"US-EN-Morgan-Freeman-Wife-Is-Arriving.wav\"\n            }\n        }\n    }\n}\n\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":580,"y":1260,"wires":[["31b8c785.cc1828"]]},{"id":"74bd3f2f.925bb","type":"weekday","z":"ea946133.0085b","name":"","sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"x":520,"y":580,"wires":[["b44ba6d0.e09aa8"],[]]},{"id":"b44ba6d0.e09aa8","type":"time-range-switch","z":"ea946133.0085b","name":"6:45am-9am","lat":"33.95092","lon":"-84.44805","startTime":"06:45","endTime":"09:00","startOffset":0,"endOffset":0,"x":690,"y":580,"wires":[[],["9abe3eba.7a1c7","69e6676b.787a18"]]},{"id":"8872c7a2.6c8f68","type":"mqtt in","z":"9143c7f2.16df18","name":"Jeff's Garage","topic":"og-jeff/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":250,"y":280,"wires":[["ff433106.9906a"]]},{"id":"9dde6613.499078","type":"mqtt in","z":"9143c7f2.16df18","name":"Jen'sGarage","topic":"og-jen/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":250,"y":340,"wires":[["ff433106.9906a"]]},{"id":"a6018167.b452c","type":"rbe","z":"9143c7f2.16df18","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":450,"y":280,"wires":[["39768268.16a7fe"]]},{"id":"39768268.16a7fe","type":"switch","z":"9143c7f2.16df18","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":280,"wires":[["fe1f1f4a.3f5bc","16f12e62.2031d2"]]},{"id":"34fb2102.da255e","type":"mqtt in","z":"ea946133.0085b","name":"Jeff's Garage","topic":"og-jeff/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":110,"y":520,"wires":[["38f6313e.822fce"]]},{"id":"92d0d009.53de7","type":"mqtt in","z":"ea946133.0085b","name":"Jen'sGarage","topic":"og-jen/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":110,"y":580,"wires":[["38f6313e.822fce"]]},{"id":"38f6313e.822fce","type":"rbe","z":"ea946133.0085b","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":310,"y":520,"wires":[["f8a13ca5.166fd"]]},{"id":"f8a13ca5.166fd","type":"switch","z":"ea946133.0085b","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":520,"wires":[["d5070b7d.fe84b8"]]},{"id":"10c8fd39.3704f3","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jen'sGarage","topic":"og-jen/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":90,"y":100,"wires":[["4e77c4e8.47d44c"]]},{"id":"9b53d510.6bf878","type":"switch","z":"75b62c93.dd5d84","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":100,"wires":[["bc004752.b8a2c8"]]},{"id":"bc004752.b8a2c8","type":"function","z":"75b62c93.dd5d84","name":"open > 30 mins?","func":"var epochMS = new Date().getTime();\nvar minsToCheck = 30;\nvar minutesInMS = 60000;\nvar initTimeMS = global.get('cover.jen_garage_door_mqtt.initTimeMS') || epochMS;\nvar duration = epochMS - initTimeMS\nglobal.set('cover.jen_garage_door_mqtt.durationTimeMS',duration);\n\nif ((duration) >= (minutesInMS*minsToCheck)) {\n  return [ msg ];\n}\n","outputs":1,"noerr":0,"x":690,"y":100,"wires":[["c8596774.8efe78","38a54037.e7812"]]},{"id":"980657f2.e40d48","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jeff's Garage","topic":"og-jeff/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":90,"y":300,"wires":[["81746025.87fff"]]},{"id":"81746025.87fff","type":"rbe","z":"75b62c93.dd5d84","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":290,"y":300,"wires":[["e240b7cc.3244e8"]]},{"id":"e240b7cc.3244e8","type":"function","z":"75b62c93.dd5d84","name":"reset jeffs door timer","func":"var epochMS = new Date().getTime();\nglobal.set('cover.jeff_garage_door_mqtt.initTimeMS',epochMS);\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":300,"wires":[[]]},{"id":"898c5725.6b1c28","type":"function","z":"75b62c93.dd5d84","name":"Jen's garage open msg","func":"var category = \"garage2\";\nvar name = \"Jen's\";\nvar title = \"Jen's Garage Door\";\nvar openTimeinMS = global.get('cover.jen_garage_door_mqtt.durationTimeMS') || 0;\nvar message_time = name + \" garage door has remained open for about \" + millisecondsToStr(openTimeinMS)\nvar message_hint = \" \\n(tap & hold this message to close the garage door now)\";\nvar quotes = [\n    'is someone about to enter the house?',\n    'what have they taken from the garage already?',\n    'easy way for rodents to get into our stuff!',\n    'is anything missing?',\n    'Once inside the garage a burglar can work uninterrupted at getting into the house',\n    'over 50% of all burglaries are through the garage',\n    'An open door is an open invitation to crime!',\n    'Leaving your garage door open is like a welcome sign for a thief!',\n    'Critters will move in and die in the garage - imagine the smell!'\n];\nvar randomQuote = Math.floor(Math.random() * (quotes.length));\nvar message = message_time + \" \\n\" + quotes[randomQuote];\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Opened.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n\nfunction millisecondsToStr (milliseconds) {\n    // TIP: to find current time in milliseconds, use:\n    // var  current_time_milliseconds = new Date().getTime();\n\n    function numberEnding (number) {\n        return (number > 1) ? 's' : '';\n    }\n\n    var temp = Math.floor(milliseconds / 1000);\n    var years = Math.floor(temp / 31536000);\n    if (years) {\n        return years + ' year' + numberEnding(years);\n    }\n    //TODO: Months! Maybe weeks? \n    var days = Math.floor((temp %= 31536000) / 86400);\n    if (days) {\n        return days + ' day' + numberEnding(days);\n    }\n    var hours = Math.floor((temp %= 86400) / 3600);\n    if (hours) {\n        return hours + ' hour' + numberEnding(hours);\n    }\n    var minutes = Math.floor((temp %= 3600) / 60);\n    if (minutes) {\n        return minutes + ' minute' + numberEnding(minutes);\n    }\n    var seconds = temp % 60;\n    if (seconds) {\n        return seconds + ' second' + numberEnding(seconds);\n    }\n    return 'less than a second'; //'just now' //or other string you like;\n}\n","outputs":1,"noerr":0,"x":1170,"y":100,"wires":[["e2f343b.68adbc","eb2d3623.194588"]]},{"id":"30580f99.aa3ee","type":"function","z":"75b62c93.dd5d84","name":"reset jens door timer","func":"var epochMS = new Date().getTime();\nglobal.set('cover.jen_garage_door_mqtt.initTimeMS',epochMS);\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":360,"wires":[[]]},{"id":"9b59b519.79bcb8","type":"inject","z":"75b62c93.dd5d84","name":"reset timers","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":290,"y":420,"wires":[["30580f99.aa3ee","e240b7cc.3244e8"]]},{"id":"9f46e22a.d6ab2","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jen'sGarage","topic":"og-jen/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":90,"y":360,"wires":[["d7b2d2e8.cc2b9"]]},{"id":"d7b2d2e8.cc2b9","type":"rbe","z":"75b62c93.dd5d84","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":290,"y":360,"wires":[["30580f99.aa3ee"]]},{"id":"c8596774.8efe78","type":"delay","z":"75b62c93.dd5d84","name":"","pauseType":"rate","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"46","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":940,"y":100,"wires":[["898c5725.6b1c28"]]},{"id":"d9b23766.5625d8","type":"switch","z":"75b62c93.dd5d84","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":220,"wires":[["db4257d1.a80da8"]]},{"id":"db4257d1.a80da8","type":"function","z":"75b62c93.dd5d84","name":"open > 30 mins?","func":"var epochMS = new Date().getTime();\nvar minsToCheck = 30;\nvar minutesInMS = 60000;\nvar initTimeMS = global.get('cover.jeff_garage_door_mqtt.initTimeMS') || epochMS;\nvar duration = epochMS - initTimeMS\nglobal.set('cover.jeff_garage_door_mqtt.durationTimeMS',duration);\n\nif ((duration) >= (minutesInMS*minsToCheck)) {\n  return [ msg ];\n}\n","outputs":1,"noerr":0,"x":690,"y":220,"wires":[["9a7bcfdf.52ec2","153a9d8e.43b672"]]},{"id":"ae4f1159.d0923","type":"function","z":"75b62c93.dd5d84","name":"Jeff's garage open msg","func":"var category = \"garage\"\nvar name = \"Jeff's\"\nvar title = \"Jeff's Garage Door\";\nvar openTimeinMS = global.get('cover.jeff_garage_door_mqtt.durationTimeMS') || 0;\nvar message = name + \" garage door has remained open for about \" + millisecondsToStr(openTimeinMS)\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Opened.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n\nfunction millisecondsToStr (milliseconds) {\n    // TIP: to find current time in milliseconds, use:\n    // var  current_time_milliseconds = new Date().getTime();\n\n    function numberEnding (number) {\n        return (number > 1) ? 's' : '';\n    }\n\n    var temp = Math.floor(milliseconds / 1000);\n    var years = Math.floor(temp / 31536000);\n    if (years) {\n        return years + ' year' + numberEnding(years);\n    }\n    //TODO: Months! Maybe weeks? \n    var days = Math.floor((temp %= 31536000) / 86400);\n    if (days) {\n        return days + ' day' + numberEnding(days);\n    }\n    var hours = Math.floor((temp %= 86400) / 3600);\n    if (hours) {\n        return hours + ' hour' + numberEnding(hours);\n    }\n    var minutes = Math.floor((temp %= 3600) / 60);\n    if (minutes) {\n        return minutes + ' minute' + numberEnding(minutes);\n    }\n    var seconds = temp % 60;\n    if (seconds) {\n        return seconds + ' second' + numberEnding(seconds);\n    }\n    return 'less than a second'; //'just now' //or other string you like;\n}\n","outputs":1,"noerr":0,"x":1170,"y":220,"wires":[["e2f343b.68adbc","eb2d3623.194588"]]},{"id":"9a7bcfdf.52ec2","type":"delay","z":"75b62c93.dd5d84","name":"","pauseType":"rate","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"46","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":940,"y":220,"wires":[["ae4f1159.d0923"]]},{"id":"460b7861.053948","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jeff's Garage","topic":"og-jeff/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":90,"y":220,"wires":[["c3f92fa3.2c705"]]},{"id":"38a54037.e7812","type":"api-current-state","z":"75b62c93.dd5d84","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_close_garage_door_jen","state_type":"str","outputs":2,"x":970,"y":40,"wires":[["cb49991c.5e93f8"],[]]},{"id":"cb49991c.5e93f8","type":"api-call-service","z":"75b62c93.dd5d84","name":"close jen's garage door","server":"8b52884a.b76658","service_domain":"cover","service":"close_cover","data":"{\"entity_id\":\"cover.jen_garage_door\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1170,"y":40,"wires":[[]]},{"id":"153a9d8e.43b672","type":"api-current-state","z":"75b62c93.dd5d84","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_close_garage_door_jeff","state_type":"str","outputs":2,"x":970,"y":160,"wires":[["cc79bb83.6bf098"],[]]},{"id":"cc79bb83.6bf098","type":"api-call-service","z":"75b62c93.dd5d84","name":"close jeff's garage door","server":"8b52884a.b76658","service_domain":"cover","service":"close_cover","data":"{\"entity_id\":\"cover.jeff_garage_door\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1170,"y":160,"wires":[[]]},{"id":"4e77c4e8.47d44c","type":"weekday","z":"75b62c93.dd5d84","name":"","sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"x":300,"y":100,"wires":[["9b53d510.6bf878"],[]]},{"id":"c3f92fa3.2c705","type":"weekday","z":"75b62c93.dd5d84","name":"","sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"x":300,"y":220,"wires":[["d9b23766.5625d8"],[]]},{"id":"2873dd6.dc95822","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jeff's Garage","topic":"og-jeff/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":90,"y":540,"wires":[["9d0ad1a5.c08d5"]]},{"id":"9d0ad1a5.c08d5","type":"rbe","z":"75b62c93.dd5d84","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":290,"y":540,"wires":[["e430cd69.5f718","43d11cf0.3ce484"]]},{"id":"e430cd69.5f718","type":"switch","z":"75b62c93.dd5d84","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":540,"wires":[["65fb8035.02a31"]]},{"id":"c42a5b00.4342c8","type":"function","z":"75b62c93.dd5d84","name":"Jeff's garage open msg","func":"var category = \"garage\"\nvar title = \"Jeff's Garage Door\";\nvar message = title + \" is open\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Opened.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":1070,"y":460,"wires":[["13e805e6.ba940a","fa6e731.f06f79"]]},{"id":"13e805e6.ba940a","type":"api-call-service","z":"75b62c93.dd5d84","name":"notify jeff iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jeffs_xs","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1440,"y":660,"wires":[[]]},{"id":"aa116aed.726218","type":"api-current-state","z":"75b62c93.dd5d84","name":"home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":810,"y":540,"wires":[["c42a5b00.4342c8"],["3ab2d709.6538b8"]]},{"id":"3ab2d709.6538b8","type":"function","z":"75b62c93.dd5d84","name":"Jeff's garage open msg","func":"var category = \"garage\"\nvar title = \"Jeff's Garage Door\";\nvar message = title + \" is open and no one is home!\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Opened.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":1070,"y":520,"wires":[["13e805e6.ba940a","fa6e731.f06f79"]]},{"id":"65fb8035.02a31","type":"api-current-state","z":"75b62c93.dd5d84","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.notify_garage_doors_home","state_type":"str","outputs":2,"x":650,"y":540,"wires":[["aa116aed.726218"],[]]},{"id":"b9d7a102.ec945","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jen's Garage","topic":"og-jen/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":90,"y":780,"wires":[["3db25583.ea405a"]]},{"id":"3db25583.ea405a","type":"rbe","z":"75b62c93.dd5d84","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":290,"y":780,"wires":[["55ae9fa4.40a39","4949faaa.0747f4"]]},{"id":"55ae9fa4.40a39","type":"switch","z":"75b62c93.dd5d84","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":780,"wires":[["c31af48.35a2a08"]]},{"id":"dba0b367.9cfa","type":"function","z":"75b62c93.dd5d84","name":"Jen's garage open msg","func":"var category = \"garage2\"\nvar title = \"Jen's Garage Door\";\nvar message = title + \" is open\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Opened.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":1070,"y":740,"wires":[["13e805e6.ba940a","fa6e731.f06f79"]]},{"id":"d8d2558c.c647a8","type":"api-current-state","z":"75b62c93.dd5d84","name":"home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":810,"y":780,"wires":[["dba0b367.9cfa"],["55f9ad38.78bbf4"]]},{"id":"55f9ad38.78bbf4","type":"function","z":"75b62c93.dd5d84","name":"Jen's garage open msg","func":"var category = \"garage2\"\nvar title = \"Jen's Garage Door\";\nvar message = title + \" is open and no one is home!\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Opened.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":1070,"y":800,"wires":[["13e805e6.ba940a","fa6e731.f06f79"]]},{"id":"c31af48.35a2a08","type":"api-current-state","z":"75b62c93.dd5d84","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.notify_garage_doors_home","state_type":"str","outputs":2,"x":650,"y":780,"wires":[["d8d2558c.c647a8"],[]]},{"id":"fa6e731.f06f79","type":"api-call-service","z":"75b62c93.dd5d84","name":"notify jen iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jennifers_xs_max","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1440,"y":720,"wires":[[]]},{"id":"43d11cf0.3ce484","type":"switch","z":"75b62c93.dd5d84","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"CLOSED","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":500,"y":600,"wires":[["449a1640.2c5008"]]},{"id":"5ba2f2e1.f603fc","type":"api-current-state","z":"75b62c93.dd5d84","name":"home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":810,"y":600,"wires":[["4cb25abb.6dc924"],["a7875b7c.d961c8"]]},{"id":"449a1640.2c5008","type":"api-current-state","z":"75b62c93.dd5d84","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.notify_garage_doors_away","state_type":"str","outputs":2,"x":650,"y":600,"wires":[["5ba2f2e1.f603fc"],[]]},{"id":"4cb25abb.6dc924","type":"function","z":"75b62c93.dd5d84","name":"Jeff's garage closed msg","func":"var category = \"garage\"\nvar title = \"Jeff's Garage Door\";\nvar message = title + \" is closed\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Closed.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":1070,"y":580,"wires":[["13e805e6.ba940a","fa6e731.f06f79"]]},{"id":"a7875b7c.d961c8","type":"function","z":"75b62c93.dd5d84","name":"Jeff's garage closed msg","func":"var category = \"garage\"\nvar title = \"Jeff's Garage Door\";\nvar message = title + \" is closed and no one is home!\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Closed.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":1070,"y":640,"wires":[["13e805e6.ba940a","fa6e731.f06f79"]]},{"id":"4949faaa.0747f4","type":"switch","z":"75b62c93.dd5d84","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"CLOSED","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":500,"y":840,"wires":[["d047908d.ea259"]]},{"id":"dfd317cd.c2e2e8","type":"api-current-state","z":"75b62c93.dd5d84","name":"home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":810,"y":840,"wires":[["5a4230ac.531df"],["1423693d.38f4a7"]]},{"id":"d047908d.ea259","type":"api-current-state","z":"75b62c93.dd5d84","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.notify_garage_doors_away","state_type":"str","outputs":2,"x":650,"y":840,"wires":[["dfd317cd.c2e2e8"],[]]},{"id":"5a4230ac.531df","type":"function","z":"75b62c93.dd5d84","name":"Jen's garage closed msg","func":"var category = \"garage2\"\nvar title = \"Jen's Garage Door\";\nvar message = title + \" is closed\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Closed.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":1070,"y":860,"wires":[["13e805e6.ba940a","fa6e731.f06f79"]]},{"id":"1423693d.38f4a7","type":"function","z":"75b62c93.dd5d84","name":"Jen's garage closed msg","func":"var category = \"garage2\"\nvar title = \"Jen's Garage Door\";\nvar message = title + \" is closed and no one is home!\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Closed.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":1070,"y":920,"wires":[["13e805e6.ba940a","fa6e731.f06f79"]]},{"id":"d7f5494a.ac87a8","type":"function","z":"2fad043e.317c8c","name":"open > 30 mins?","func":"var minsToCheck = 30;\nvar minutesInMs = 60000;\nvar openTimeinMS = global.get('cover.jen_garage_door.openTimeinMS') || 0;\n\nif (openTimeinMS >= (minutesInMs*minsToCheck) && msg.payload === \"open\") {\n   return [ msg ];\n}","outputs":1,"noerr":0,"x":850,"y":1820,"wires":[["48ae7752.987008","ff456fb3.f8285"]]},{"id":"37abc17f.fcedee","type":"api-call-service","z":"2fad043e.317c8c","name":"close jen's garage door","server":"8b52884a.b76658","service_domain":"cover","service":"close_cover","data":"{\"entity_id\":\"cover.jen_garage_door\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1330,"y":1780,"wires":[[]]},{"id":"48ae7752.987008","type":"api-current-state","z":"2fad043e.317c8c","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_close_garage_door_jen","state_type":"str","outputs":2,"x":1130,"y":1780,"wires":[["37abc17f.fcedee"],[]]},{"id":"de0fab42.363648","type":"function","z":"2fad043e.317c8c","name":"open > 30 mins?","func":"var minsToCheck = 30;\nvar minutesInMs = 60000;\nvar openTimeinMS = global.get('cover.jeff_garage_door.openTimeinMS') || 0;\n\nif (openTimeinMS >= (minutesInMs*minsToCheck) && msg.payload === \"open\") {\n   return [ msg ];\n}","outputs":1,"noerr":0,"x":850,"y":1940,"wires":[["e534ddd2.7c0f7","d6091093.cb93c"]]},{"id":"d20bd289.82802","type":"api-call-service","z":"2fad043e.317c8c","name":"close jeff's garage door","server":"8b52884a.b76658","service_domain":"cover","service":"close_cover","data":"{\"entity_id\":\"cover.jeff_garage_door\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1330,"y":1900,"wires":[[]]},{"id":"e534ddd2.7c0f7","type":"api-current-state","z":"2fad043e.317c8c","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_close_garage_door_jeff","state_type":"str","outputs":2,"x":1130,"y":1900,"wires":[["d20bd289.82802"],[]]},{"id":"c38a17e9.a67c08","type":"function","z":"2fad043e.317c8c","name":"Jen's garage open msg","func":"\nvar category = \"garage2\";\nvar name = \"Jen's\";\nvar title = msg.data.event.new_state.attributes.friendly_name;\nvar openTimeinMS = global.get('cover.jen_garage_door.openTimeinMS') || 0;\nvar message_time = name + \" garage door has remained open for about \" + millisecondsToStr(openTimeinMS)\nvar message_hint = \" \\n(tap & hold this message to close the garage door now)\";\nvar quotes = [\n    'is someone about to enter the house?',\n    'what have they taken from the garage already?',\n    'easy way for rodents to get into our stuff!',\n    'is anything missing?',\n    'Once inside the garage a burglar can work uninterrupted at getting into the house',\n    'over 50% of all burglaries are through the garage',\n    'An open door is an open invitation to crime!',\n    'Leaving your garage door open is like a welcome sign for a thief!'\n];\nvar randomQuote = Math.floor(Math.random() * (quotes.length));\nvar message = message_time + \" \\n\" + quotes[randomQuote];\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Opened.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n\nfunction millisecondsToStr (milliseconds) {\n    // TIP: to find current time in milliseconds, use:\n    // var  current_time_milliseconds = new Date().getTime();\n\n    function numberEnding (number) {\n        return (number > 1) ? 's' : '';\n    }\n\n    var temp = Math.floor(milliseconds / 1000);\n    var years = Math.floor(temp / 31536000);\n    if (years) {\n        return years + ' year' + numberEnding(years);\n    }\n    //TODO: Months! Maybe weeks? \n    var days = Math.floor((temp %= 31536000) / 86400);\n    if (days) {\n        return days + ' day' + numberEnding(days);\n    }\n    var hours = Math.floor((temp %= 86400) / 3600);\n    if (hours) {\n        return hours + ' hour' + numberEnding(hours);\n    }\n    var minutes = Math.floor((temp %= 3600) / 60);\n    if (minutes) {\n        return minutes + ' minute' + numberEnding(minutes);\n    }\n    var seconds = temp % 60;\n    if (seconds) {\n        return seconds + ' second' + numberEnding(seconds);\n    }\n    return 'less than a second'; //'just now' //or other string you like;\n}\n","outputs":1,"noerr":0,"x":1330,"y":1840,"wires":[[]]},{"id":"ff456fb3.f8285","type":"delay","z":"2fad043e.317c8c","name":"","pauseType":"rate","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"46","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1100,"y":1840,"wires":[["c38a17e9.a67c08"]]},{"id":"609cfeb9.46947","type":"function","z":"2fad043e.317c8c","name":"Jeff's garage open msg","func":"var category = \"garage\"\nvar name = \"Jeff's\"\nvar title = msg.data.event.new_state.attributes.friendly_name;\nvar openTimeinMS = global.get('cover.jeff_garage_door.openTimeinMS') || 0;\nvar message = name + \" garage door has remained open for about \" + millisecondsToStr(openTimeinMS)\n\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category,\n                sound: \"US-EN-Morgan-Freeman-Garage-Door-Opened.wav\"\n            }\n        }\n    }\n}\nreturn [ msg ];\n\nfunction millisecondsToStr (milliseconds) {\n    // TIP: to find current time in milliseconds, use:\n    // var  current_time_milliseconds = new Date().getTime();\n\n    function numberEnding (number) {\n        return (number > 1) ? 's' : '';\n    }\n\n    var temp = Math.floor(milliseconds / 1000);\n    var years = Math.floor(temp / 31536000);\n    if (years) {\n        return years + ' year' + numberEnding(years);\n    }\n    //TODO: Months! Maybe weeks? \n    var days = Math.floor((temp %= 31536000) / 86400);\n    if (days) {\n        return days + ' day' + numberEnding(days);\n    }\n    var hours = Math.floor((temp %= 86400) / 3600);\n    if (hours) {\n        return hours + ' hour' + numberEnding(hours);\n    }\n    var minutes = Math.floor((temp %= 3600) / 60);\n    if (minutes) {\n        return minutes + ' minute' + numberEnding(minutes);\n    }\n    var seconds = temp % 60;\n    if (seconds) {\n        return seconds + ' second' + numberEnding(seconds);\n    }\n    return 'less than a second'; //'just now' //or other string you like;\n}","outputs":1,"noerr":0,"x":1330,"y":1960,"wires":[[]]},{"id":"d6091093.cb93c","type":"delay","z":"2fad043e.317c8c","name":"","pauseType":"rate","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"46","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1100,"y":1960,"wires":[["609cfeb9.46947"]]},{"id":"f5781487.e5cb88","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's door open?","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"03b4hq1eehkp","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"9b1umrt4zg4","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":170,"y":1820,"wires":[["2fdf6f92.87999"],[]]},{"id":"49c79cd6.234ae4","type":"function","z":"2fad043e.317c8c","name":"add current open time","func":"var currentSavedTime = global.get('cover.jen_garage_door.openTimeinMS') || 0;\nglobal.set('cover.jen_garage_door.openTimeinMS', Math.abs(msg.data.event.new_state.timeSinceChangedMs - currentSavedTime) + currentSavedTime);\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":1820,"wires":[["d7f5494a.ac87a8"]]},{"id":"d04b4ada.18ee38","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's door open?","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"03b4hq1eehkp","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"tle0bbbbad","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":170,"y":1940,"wires":[["64a74a.07b288b8"],[]]},{"id":"510c5991.b07a78","type":"function","z":"2fad043e.317c8c","name":"add current open time","func":"var currentSavedTime = global.get('cover.jeff_garage_door.openTimeinMS') || 0;\nglobal.set('cover.jeff_garage_door.openTimeinMS', Math.abs(msg.data.event.new_state.timeSinceChangedMs - currentSavedTime) + currentSavedTime);\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":1940,"wires":[["de0fab42.363648"]]},{"id":"d31378a4.d54338","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's door closed -> open","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7ssscforb0o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"ca2smqkbbur","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":2020,"wires":[["cea26499.ab66b8"],[]]},{"id":"cea26499.ab66b8","type":"function","z":"2fad043e.317c8c","name":"reset jens door timer","func":"global.set('cover.jen_garage_door.openTimeinMS',0);\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":2020,"wires":[[]]},{"id":"72c4436.33817bc","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's door closed -> open","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7ssscforb0o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"ca2smqkbbur","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":2080,"wires":[["d08e0432.2ff2a8"],[]]},{"id":"d08e0432.2ff2a8","type":"function","z":"2fad043e.317c8c","name":"reset jeff door timer","func":"global.set('cover.jeff_garage_door.openTimeinMS',0);\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":2080,"wires":[[]]},{"id":"79bf855c.c19dec","type":"inject","z":"2fad043e.317c8c","name":"reset timers","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":2200,"wires":[["cea26499.ab66b8","d08e0432.2ff2a8"]]},{"id":"6c3b318a.a98d9","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's door open -> closed","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"g9u7cbbteu8","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"},{"id":"iydwvunsg8","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":2140,"wires":[["cea26499.ab66b8"],[]]},{"id":"8b3f913d.eb1ed","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's door open -> closed","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"19z302q4msn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"},{"id":"1kylpoo28e7","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":2200,"wires":[["d08e0432.2ff2a8"],[]]},{"id":"2fdf6f92.87999","type":"weekday","z":"2fad043e.317c8c","name":"","sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"x":380,"y":1820,"wires":[["49c79cd6.234ae4"],[]]},{"id":"64a74a.07b288b8","type":"weekday","z":"2fad043e.317c8c","name":"","sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"x":380,"y":1940,"wires":[["510c5991.b07a78"],[]]},{"id":"5b85b6ec.48bd58","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's garage door closed -> open","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7ssscforb0o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"ca2smqkbbur","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":2280,"wires":[[],[]]},{"id":"a388fdb6.d99c6","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's garage door closed -> open","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7ssscforb0o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"ca2smqkbbur","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":2340,"wires":[[],[]]},{"id":"e744fbe.5ec6708","type":"api-call-service","z":"2fad043e.317c8c","name":"save front snapshot","server":"8b52884a.b76658","service_domain":"camera","service":"snapshot","data":"{\"entity_id\":\"camera.front\",\"filename\":\"/config/www/camera/camera.front.jpg\"}","render_data":true,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":950,"y":1440,"wires":[[]]},{"id":"f365df1c.c46c7","type":"api-call-service","z":"2fad043e.317c8c","name":"save driveway snapshot","server":"8b52884a.b76658","service_domain":"camera","service":"snapshot","data":"{\"entity_id\":\"camera.driveway\",\"filename\":\"/config/www/camera/camera.driveway.jpg\"}","render_data":true,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":970,"y":1500,"wires":[[]]},{"id":"f646fe81.b0e6e","type":"api-call-service","z":"2fad043e.317c8c","name":"save porch snapshot","server":"8b52884a.b76658","service_domain":"camera","service":"snapshot","data":"{\"entity_id\":\"camera.porch\",\"filename\":\"/config/www/camera/camera.porch.jpg\"}","render_data":true,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":960,"y":1560,"wires":[[]]},{"id":"2e956d98.030a92","type":"api-call-service","z":"2fad043e.317c8c","name":"save pool snapshot","server":"8b52884a.b76658","service_domain":"camera","service":"snapshot","data":"{\"entity_id\":\"camera.pool\",\"filename\":\"/config/www/camera/camera.pool.jpg\"}","render_data":true,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":950,"y":1620,"wires":[[]]},{"id":"58344902.773898","type":"api-call-service","z":"2fad043e.317c8c","name":"save basement snapshot","server":"8b52884a.b76658","service_domain":"camera","service":"snapshot","data":"{\"entity_id\":\"camera.basement\",\"filename\":\"/config/www/camera/camera.basement.jpg\"}","render_data":true,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":970,"y":1680,"wires":[[]]},{"id":"9175ff65.a0fbf","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's garage door closed -> open","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7ssscforb0o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"ca2smqkbbur","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":2400,"wires":[[],[]]},{"id":"f414eefc.1ff79","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's garage door closed -> open","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7ssscforb0o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"},{"id":"ca2smqkbbur","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":2460,"wires":[[],[]]},{"id":"933e6891.999fd8","type":"trigger-state","z":"2fad043e.317c8c","name":"jeff's garage open -> closed?","server":"8b52884a.b76658","entityid":"cover.jeff_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"lfo3f7bo72","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"},{"id":"4rtzy4dvtq3","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":200,"y":2520,"wires":[[],[]]},{"id":"29ff3ef2.e293a2","type":"trigger-state","z":"2fad043e.317c8c","name":"jen's garage open -> closed?","server":"8b52884a.b76658","entityid":"cover.jen_garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"lq80ra8i42","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"},{"id":"er5106nygad","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":200,"y":2580,"wires":[[],[]]},{"id":"59496f1a.445e4","type":"mqtt in","z":"2fad043e.317c8c","name":"Jeff's Garage","topic":"og-jeff/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":570,"y":2280,"wires":[["c9f8247f.7545c8"]]},{"id":"8472baf2.9b2ff8","type":"mqtt in","z":"2fad043e.317c8c","name":"Jen'sGarage","topic":"og-jen/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":570,"y":2340,"wires":[["c9f8247f.7545c8"]]},{"id":"72157b5e.eb6a94","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1070,"y":2460,"wires":[]},{"id":"c9f8247f.7545c8","type":"rbe","z":"2fad043e.317c8c","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":850,"y":2320,"wires":[["72157b5e.eb6a94","19d01461.8f5bdc","b4ba092f.066458"]]},{"id":"47f521f8.e8511","type":"mqtt in","z":"2fad043e.317c8c","name":"Jen's Garage Notify","topic":"og-jen/OUT/NOTIFY","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":590,"y":2460,"wires":[["230cff5a.e06e9","5169186b.d08058"]]},{"id":"230cff5a.e06e9","type":"switch","z":"2fad043e.317c8c","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"og-jen just CLOSED!","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":840,"y":2460,"wires":[["72157b5e.eb6a94"]]},{"id":"5169186b.d08058","type":"switch","z":"2fad043e.317c8c","name":"opened?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"og-jen just OPENED!","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":840,"y":2520,"wires":[["72157b5e.eb6a94"]]},{"id":"b65c3188.bd83","type":"mqtt in","z":"2fad043e.317c8c","name":"Jeff's Garage Notify","topic":"og-jeff/OUT/NOTIFY","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":590,"y":2580,"wires":[["c9e5925d.d7aa8","e061073f.d0d4f8"]]},{"id":"c9e5925d.d7aa8","type":"switch","z":"2fad043e.317c8c","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"og-jeff just CLOSED!","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":840,"y":2580,"wires":[["72157b5e.eb6a94"]]},{"id":"e061073f.d0d4f8","type":"switch","z":"2fad043e.317c8c","name":"opened?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"og-jeff just OPENED!","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":840,"y":2640,"wires":[["72157b5e.eb6a94"]]},{"id":"19d01461.8f5bdc","type":"switch","z":"2fad043e.317c8c","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"CLOSED","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1060,"y":2320,"wires":[["3a378387.d3a07c"]]},{"id":"3a378387.d3a07c","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1250,"y":2320,"wires":[]},{"id":"b4ba092f.066458","type":"switch","z":"2fad043e.317c8c","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1050,"y":2380,"wires":[["2bce1f4b.5bd6f"]]},{"id":"2bce1f4b.5bd6f","type":"debug","z":"2fad043e.317c8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1250,"y":2380,"wires":[]},{"id":"93e7ad58.885c2","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jeff's Garage","topic":"og-jeff/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":90,"y":1040,"wires":[["56b0bcd3.f0e714"]]},{"id":"a6d03bce.cc1198","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jen'sGarage","topic":"og-jen/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":90,"y":1100,"wires":[["56b0bcd3.f0e714"]]},{"id":"99c3535a.4ffba","type":"debug","z":"75b62c93.dd5d84","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":1220,"wires":[]},{"id":"56b0bcd3.f0e714","type":"rbe","z":"75b62c93.dd5d84","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":370,"y":1080,"wires":[["99c3535a.4ffba","1a550425.29b8fc","9980cab.7668438"]]},{"id":"8297029c.467e7","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jen's Garage Notify","topic":"og-jen/OUT/NOTIFY","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":110,"y":1220,"wires":[["13586b8f.ec2774","b8116454.0479d8"]]},{"id":"13586b8f.ec2774","type":"switch","z":"75b62c93.dd5d84","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"og-jen just CLOSED!","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":1220,"wires":[["99c3535a.4ffba"]]},{"id":"b8116454.0479d8","type":"switch","z":"75b62c93.dd5d84","name":"opened?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"og-jen just OPENED!","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":1280,"wires":[["99c3535a.4ffba"]]},{"id":"10ae1978.bdd827","type":"mqtt in","z":"75b62c93.dd5d84","name":"Jeff's Garage Notify","topic":"og-jeff/OUT/NOTIFY","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":110,"y":1340,"wires":[["3b77f328.563cbc","3300f432.7f160c"]]},{"id":"3b77f328.563cbc","type":"switch","z":"75b62c93.dd5d84","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"og-jeff just CLOSED!","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":1340,"wires":[["99c3535a.4ffba"]]},{"id":"3300f432.7f160c","type":"switch","z":"75b62c93.dd5d84","name":"opened?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"og-jeff just OPENED!","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":1400,"wires":[["99c3535a.4ffba"]]},{"id":"1a550425.29b8fc","type":"switch","z":"75b62c93.dd5d84","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"CLOSED","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":580,"y":1080,"wires":[[]]},{"id":"9980cab.7668438","type":"switch","z":"75b62c93.dd5d84","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":1140,"wires":[[]]},{"id":"d5070b7d.fe84b8","type":"api-current-state","z":"ea946133.0085b","name":"not home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":350,"y":640,"wires":[["69e6676b.787a18"],[]]},{"id":"17f44848.8dcc08","type":"api-call-service","z":"75b62c93.dd5d84","name":"notify jeff iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jeffs_xs","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1460,"y":460,"wires":[[]]},{"id":"10f051eb.ba086e","type":"trigger-state","z":"9143c7f2.16df18","name":"Jeff home -> not_home (phone)","server":"8b52884a.b76658","entityid":"device_tracker.jeffs_xs_2","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"z1zzizr1n1","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"geusjwd530t","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"not_home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","x":190,"y":1520,"wires":[["bf864de8.18e4d"],[]]},{"id":"272f26fc.9b142a","type":"api-current-state","z":"9143c7f2.16df18","name":"Jeff's garage open?","server":"8b52884a.b76658","halt_if":"Open","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.garage_status","state_type":"str","outputs":2,"x":760,"y":1520,"wires":[["20a848fc.bdd958","3df07393.cdbafc"],[]]},{"id":"20a848fc.bdd958","type":"function","z":"9143c7f2.16df18","name":"Format iOS message","func":"var title = \"AUTO GARAGE\"\nvar message = \"Closing Garage Door!\"\nvar category = \"garage\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category\n            }\n        }\n    }\n}\nreturn [ msg ];","outputs":1,"noerr":0,"x":1300,"y":1520,"wires":[["3d25cae7.4c2386"]]},{"id":"143ed0fb.82445f","type":"trigger-state","z":"9143c7f2.16df18","name":"Jeff not_home -> home (phone)","server":"8b52884a.b76658","entityid":"device_tracker.jeffs_xs_2","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"n2mfbe9vw6a","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"s04vxlpox79","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"not_home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","x":190,"y":1580,"wires":[["43065ee0.99c75"],[]]},{"id":"cf9e831e.7d2c2","type":"api-current-state","z":"9143c7f2.16df18","name":"Jeff's car missing?","server":"8b52884a.b76658","halt_if":"Yes","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.garage_car_present","state_type":"str","outputs":2,"x":1030,"y":1580,"wires":[["6b58699b.a00cb8","1dca254c.cf619b"],[]]},{"id":"69430b66.5d27b4","type":"api-current-state","z":"9143c7f2.16df18","name":"Jeff's garage closed?","server":"8b52884a.b76658","halt_if":"Closed","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.garage_status","state_type":"str","outputs":2,"x":760,"y":1580,"wires":[["cf9e831e.7d2c2"],[]]},{"id":"6b58699b.a00cb8","type":"function","z":"9143c7f2.16df18","name":"Format iOS message","func":"var title = \"AUTO GARAGE\"\nvar message = \"Opening Garage Door!\"\nvar category = \"garage_open\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n        data: {\n            push: {\n                category: category\n            }\n        }\n    }\n}\nreturn [ msg ];","outputs":1,"noerr":0,"x":1300,"y":1580,"wires":[["3d25cae7.4c2386"]]},{"id":"3d25cae7.4c2386","type":"api-call-service","z":"9143c7f2.16df18","name":"notify jeff iOS","server":"8b52884a.b76658","service_domain":"notify","service":"mobile_app_jeffs_xs","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1540,"y":1540,"wires":[[]]},{"id":"bf864de8.18e4d","type":"api-current-state","z":"9143c7f2.16df18","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_garage_doors","state_type":"str","outputs":2,"x":530,"y":1520,"wires":[["272f26fc.9b142a"],[]]},{"id":"3df07393.cdbafc","type":"api-call-service","z":"9143c7f2.16df18","name":"close jeff's garage door","server":"8b52884a.b76658","service_domain":"cover","service":"close_cover","data":"{\"entity_id\":\"cover.jeff_garage_door\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1310,"y":1480,"wires":[[]]},{"id":"43065ee0.99c75","type":"api-current-state","z":"9143c7f2.16df18","name":"run?","server":"8b52884a.b76658","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.auto_garage_doors","state_type":"str","outputs":2,"x":530,"y":1580,"wires":[["69430b66.5d27b4"],[]]},{"id":"1dca254c.cf619b","type":"api-call-service","z":"9143c7f2.16df18","name":"open jeff's garage door","server":"8b52884a.b76658","service_domain":"cover","service":"open_cover","data":"{\"entity_id\":\"cover.jeff_garage_door\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1310,"y":1620,"wires":[[]]},{"id":"da4a802.356038","type":"trigger-state","z":"9143c7f2.16df18","name":"Jeff home -> not_home (bluetooth)","server":"8b52884a.b76658","entityid":"input_boolean.jeff_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"a93we87h1kg","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"h6jm2s5l4bl","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","x":180,"y":1340,"wires":[["56dfba26.07b614"],[]]},{"id":"49d47ae6.ee94b4","type":"trigger-state","z":"9143c7f2.16df18","name":"Jeff not_home -> home (bluetooth)","server":"8b52884a.b76658","entityid":"input_boolean.jeff_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"wg2s91i7aoc","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"v6qek090ryb","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","x":180,"y":1400,"wires":[["48bb12b0.1900dc"],[]]},{"id":"56dfba26.07b614","type":"function","z":"9143c7f2.16df18","name":"Format iOS message","func":"var title = \"Presence\"\nvar message = \"Jeff leaving (btle)\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n    }\n}\nreturn [ msg ];","outputs":1,"noerr":0,"x":580,"y":1340,"wires":[["31b8c785.cc1828"]]},{"id":"48bb12b0.1900dc","type":"function","z":"9143c7f2.16df18","name":"Format iOS message","func":"var title = \"Presence\"\nvar message = \"Jeff arriving (btle)\"\n\nmsg.payload = {\n    \"data\": {\n        message,\n        title,\n    }\n}\nreturn [ msg ];","outputs":1,"noerr":0,"x":580,"y":1400,"wires":[["31b8c785.cc1828"]]},{"id":"dd155455.bc9c28","type":"trigger-state","z":"af228686.65c8a8","name":"not_home -> home","server":"8b52884a.b76658","entityid":"sensor.anyone_home","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"n16bzdqj6p","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"1cv3kmbt40v","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"not_home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":110,"y":160,"wires":[["b98bed87.b9424"],[]]},{"id":"213c8891.deb658","type":"trigger-state","z":"af228686.65c8a8","name":"home -> not_home","server":"8b52884a.b76658","entityid":"sensor.anyone_home","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"m9qiqujd83","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"not_home"},{"id":"wl8tjeww34","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":110,"y":220,"wires":[["2159612f.fdce8e"],[]]},{"id":"34918ede.fb8b02","type":"api-call-service","z":"af228686.65c8a8","name":"tree lights","server":"8b52884a.b76658","service_domain":"switch","service":"","data":"{\"entity_id\":\"switch.portable_outlet_a_switch\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":920,"y":100,"wires":[[]]},{"id":"303042fc.f96d7e","type":"api-call-service","z":"af228686.65c8a8","name":"tree turn off","server":"8b52884a.b76658","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"switch.portable_outlet_a_switch\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":370,"y":820,"wires":[[]]},{"id":"b5ce153f.7eca98","type":"api-call-service","z":"af228686.65c8a8","name":"cabinet lights","server":"8b52884a.b76658","service_domain":"switch","service":"","data":"{\"entity_id\":\"group.cabinet_lights\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":940,"y":180,"wires":[[]]},{"id":"5a335a8b.9002f4","type":"api-call-service","z":"af228686.65c8a8","name":"cabinet lights turn off","server":"8b52884a.b76658","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"switch.portable_outlet_b_switch\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":400,"y":880,"wires":[[]]},{"id":"ff8f8ce3.d9c16","type":"inject","z":"af228686.65c8a8","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":100,"wires":[["aeb0b243.17cee"]]},{"id":"ea46e4e8.428538","type":"light-scheduler-filter","z":"af228686.65c8a8","settings":"f26da246.74a7f","events":"[{\"start\":{\"dow\":1,\"mod\":0},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":0},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":0},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":0},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":0},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":0},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":0},\"end\":{\"dow\":1,\"mod\":0}}]","name":"dusk/dawn filter (full)","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":true,"x":120,"y":820,"wires":[[],[]]},{"id":"61fc1df9.0386c4","type":"light-scheduler","z":"af228686.65c8a8","settings":"f26da246.74a7f","events":"[{\"start\":{\"dow\":1,\"mod\":0},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":0},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":0},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":0},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":0},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":0},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":0},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"","name":"dusk/dawn (full)","onPayload":"turn_on","onPayloadType":"str","offPayload":"turn_off","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":true,"outputfreq":"output.statechange","x":100,"y":880,"wires":[[]]},{"id":"c3884fae.62ca4","type":"function","z":"af228686.65c8a8","name":"turn_on","func":"var service = \"turn_on\"\n\nmsg.payload = {\n    \"service\": service,\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":540,"y":180,"wires":[["b5ce153f.7eca98"]]},{"id":"b98bed87.b9424","type":"light-scheduler-filter","z":"af228686.65c8a8","settings":"f26da246.74a7f","events":"[{\"start\":{\"dow\":1,\"mod\":900},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":900},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":900},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":900},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":900},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":900},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":900},\"end\":{\"dow\":1,\"mod\":0}}]","name":"dusk/dawn filter","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":"8","sunShowElevationInStatus":true,"x":340,"y":160,"wires":[["c3884fae.62ca4"],["2159612f.fdce8e"]]},{"id":"2159612f.fdce8e","type":"function","z":"af228686.65c8a8","name":"turn_off","func":"var service = \"turn_off\"\n\nmsg.payload = {\n    \"service\": service,\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":540,"y":240,"wires":[["b5ce153f.7eca98","296d6fd9.c260d","2539441b.ea6d3c"]]},{"id":"4061f4ae.2bc80c","type":"server-state-changed","z":"af228686.65c8a8","name":"garage door open?","server":"8b52884a.b76658","entityidfilter":"binary_sensor.garage_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":110,"y":300,"wires":[["b8873014.0bbc5","55b91038.35107"],[]]},{"id":"b8873014.0bbc5","type":"function","z":"af228686.65c8a8","name":"turn_on","func":"var service = \"turn_on\"\n\nmsg.payload = {\n    \"service\": service,\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":540,"y":300,"wires":[["296d6fd9.c260d"]]},{"id":"296d6fd9.c260d","type":"api-call-service","z":"af228686.65c8a8","name":"garage lights","server":"8b52884a.b76658","service_domain":"light","service":"","data":"{\"entity_id\":\"light.sunroom_garage_dimmer\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":930,"y":300,"wires":[[]]},{"id":"55b91038.35107","type":"delay","z":"af228686.65c8a8","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":400,"wires":[["385c4679.7334ca"]]},{"id":"385c4679.7334ca","type":"function","z":"af228686.65c8a8","name":"turn_off","func":"var service = \"turn_off\"\n\nmsg.payload = {\n    \"service\": service,\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":720,"y":400,"wires":[["296d6fd9.c260d"]]},{"id":"553dd4ac.2f6e4c","type":"mqtt in","z":"af228686.65c8a8","name":"Jeff's Garage","topic":"og-jeff/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":130,"y":380,"wires":[["827b5c98.ca3f8"]]},{"id":"5cb60b49.9a87e4","type":"mqtt in","z":"af228686.65c8a8","name":"Jen's Garage","topic":"og-jen/OUT/STATE","qos":"2","datatype":"auto","broker":"649859a4.a17818","x":130,"y":440,"wires":[["827b5c98.ca3f8"]]},{"id":"4b2cdbdc.3114a4","type":"rbe","z":"b8b74cae.ffe4","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":190,"y":80,"wires":[["99015cad.bf158"]]},{"id":"99015cad.bf158","type":"switch","z":"b8b74cae.ffe4","name":"open?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":80,"wires":[[]]},{"id":"827b5c98.ca3f8","type":"subflow:b8b74cae.ffe4","z":"af228686.65c8a8","name":"open?","env":[],"x":310,"y":400,"wires":[["b8873014.0bbc5","55b91038.35107"]]},{"id":"39ce4ca0.57f4a4","type":"rbe","z":"a9b8c57d.9659a8","name":"state change","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":190,"y":80,"wires":[["d1347059.c62f3"]]},{"id":"d1347059.c62f3","type":"switch","z":"a9b8c57d.9659a8","name":"closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"CLOSED","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":380,"y":80,"wires":[[]]},{"id":"ff433106.9906a","type":"subflow:b8b74cae.ffe4","z":"9143c7f2.16df18","name":"","x":550,"y":340,"wires":[["16f12e62.2031d2","fe1f1f4a.3f5bc"]]},{"id":"230d3ec9.e71a02","type":"api-call-service","z":"af228686.65c8a8","name":"porch light","server":"8b52884a.b76658","service_domain":"light","service":"","data":"{\"entity_id\":\"light.porch_porch_dimmer\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":930,"y":40,"wires":[[]]},{"id":"aeb0b243.17cee","type":"light-scheduler","z":"af228686.65c8a8","settings":"f26da246.74a7f","events":"[{\"start\":{\"dow\":1,\"mod\":330},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":330},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":330},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":330},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":330},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":330},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":330},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"service","name":"dusk/dawn","onPayload":"turn_on","onPayloadType":"str","offPayload":"turn_off","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":"8","sunShowElevationInStatus":true,"outputfreq":"output.statechange.startup","x":330,"y":100,"wires":[["710faff9.f3bb5"]]},{"id":"710faff9.f3bb5","type":"function","z":"af228686.65c8a8","name":"format","func":"var input = msg.payload\n\nmsg.payload = {\n    \"service\": input,\n}\nreturn [ msg ];\n","outputs":1,"noerr":0,"x":530,"y":100,"wires":[["230d3ec9.e71a02","34918ede.fb8b02","f6e6a362.ad7e6"]]},{"id":"2539441b.ea6d3c","type":"api-call-service","z":"af228686.65c8a8","name":"pool light","server":"8b52884a.b76658","service_domain":"light","service":"","data":"{\"entity_id\":\"switch.pool_pool_switch\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":920,"y":240,"wires":[[]]},{"id":"f6e6a362.ad7e6","type":"api-current-state","z":"af228686.65c8a8","name":"home?","server":"8b52884a.b76658","halt_if":"home","halt_if_type":"str","halt_if_compare":"is_not","override_topic":false,"override_payload":false,"override_data":false,"entity_id":"sensor.anyone_home","state_type":"str","outputs":2,"x":710,"y":140,"wires":[["b5ce153f.7eca98"],[]]}]